<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Where there is a will, there is a way!">
<meta property="og:type" content="website">
<meta property="og:title" content="ZhangYouzhi's Blog">
<meta property="og:url" content="http://zhangyouzhi.com/page/2/index.html">
<meta property="og:site_name" content="ZhangYouzhi's Blog">
<meta property="og:description" content="Where there is a will, there is a way!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZhangYouzhi's Blog">
<meta name="twitter:description" content="Where there is a will, there is a way!">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> ZhangYouzhi's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ZhangYouzhi's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/12/Linux-FTP-configuration/" itemprop="url">
                  Linux 下进行 FTP 设置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-02-12T09:58:58+08:00" content="2015-02-12">
              2015-02-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/工作/" itemprop="url" rel="index">
                    <span itemprop="name">工作</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u4E00_u3001Redhat/CentOS_u5B89_u88C5vsftp_u8F6F_u4EF6"><a href="#u4E00_u3001Redhat/CentOS_u5B89_u88C5vsftp_u8F6F_u4EF6" class="headerlink" title="一、Redhat/CentOS安装vsftp软件"></a>一、Redhat/CentOS安装vsftp软件</h3><h4 id="1-_u66F4_u65B0yum_u6E90"><a href="#1-_u66F4_u65B0yum_u6E90" class="headerlink" title="1.更新yum源"></a>1.更新yum源</h4><p>首先需要更新系统的yum源，便捷工具下载地址：<a href="http://help.aliyun.com/manual?spm=0.0.0.0.zJ3dBU&amp;helpId=1692" target="_blank" rel="external">http://help.aliyun.com/manual?spm=0.0.0.0.zJ3dBU&amp;helpId=1692</a></p>
<h4 id="2-_u5B89_u88C5vsftp"><a href="#2-_u5B89_u88C5vsftp" class="headerlink" title="2.安装vsftp"></a>2.安装vsftp</h4><p>使用yum命令安装vsftp<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#yum install vsftpd -y</span><br></pre></td></tr></table></figure></p>
<h4 id="3-_u6DFB_u52A0ftp_u5E10_u53F7_u548C_u76EE_u5F55"><a href="#3-_u6DFB_u52A0ftp_u5E10_u53F7_u548C_u76EE_u5F55" class="headerlink" title="3.添加ftp帐号和目录"></a>3.添加ftp帐号和目录</h4><p>先检查一下nologin的位置，通常在/usr/sbin/nologin或者/sbin/nologin下。</p>
<p>使用下面的命令创建帐户，该命令指定了/alidata/www/wwwroot为用户pwftp的家目录，您可以自己定义帐户名和目录：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#useradd -d /alidata/www/wwwroot -s /sbin/nologin pwftp</span><br></pre></td></tr></table></figure></p>
<p>修改该帐户密码:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#passwd pwftp</span><br></pre></td></tr></table></figure></p>
<p>修改指定目录的权限<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#chown -R pwftp.pwftp /alidata/www/wwwroot</span><br></pre></td></tr></table></figure></p>
<h4 id="4-_u914D_u7F6Evsftp"><a href="#4-_u914D_u7F6Evsftp" class="headerlink" title="4.配置vsftp"></a>4.配置vsftp</h4><p>编辑vsftp配置文件，命令如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vi /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>将配置文件中”anonymous_enable=YES “改为 “anonymous_enable=NO”</p>
<p>取消如下配置前的注释符号：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local_enable=YES&#10;&#10;write_enable=YES&#10;&#10;chroot_local_user=YES</span><br></pre></td></tr></table></figure></p>
<p>保存修改，按ESC键，输入：wq</p>
<h4 id="5-_u4FEE_u6539shell_u914D_u7F6E"><a href="#5-_u4FEE_u6539shell_u914D_u7F6E" class="headerlink" title="5.修改shell配置"></a>5.修改shell配置</h4><p>vi编辑/etc/shells，如果该文件里没有/usr/sbin/nologin或者/sbin/nologin（具体看当前系统配置）则追加进去</p>
<h4 id="6-_u542F_u52A8vsftp_u670D_u52A1_u5E76_u6D4B_u8BD5_u767B_u5F55"><a href="#6-_u542F_u52A8vsftp_u670D_u52A1_u5E76_u6D4B_u8BD5_u767B_u5F55" class="headerlink" title="6.启动vsftp服务并测试登录"></a>6.启动vsftp服务并测试登录</h4><p>使用命令启动vsftp服务：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#service vsftpd start</span><br></pre></td></tr></table></figure></p>
<p>然后用帐号pwftp测试下是否可以登陆ftp。目录是/alidata/www/wwwroot。</p>
<h3 id="u4E8C_u3001Ubuntu/Debian_u5B89_u88C5vsftp_u8F6F_u4EF6"><a href="#u4E8C_u3001Ubuntu/Debian_u5B89_u88C5vsftp_u8F6F_u4EF6" class="headerlink" title="二、Ubuntu/Debian安装vsftp软件"></a>二、Ubuntu/Debian安装vsftp软件</h3><h4 id="1-_u66F4_u65B0_u8F6F_u4EF6_u6E90"><a href="#1-_u66F4_u65B0_u8F6F_u4EF6_u6E90" class="headerlink" title="1.更新软件源"></a>1.更新软件源</h4><p>首先需要更新系统的软件源，便捷工具下载地址：<a href="http://help.aliyun.com/manual?spm=0.0.0.0.zJ3dBU&amp;helpId=1692" target="_blank" rel="external">http://help.aliyun.com/manual?spm=0.0.0.0.zJ3dBU&amp;helpId=1692</a></p>
<h4 id="2-_u5B89_u88C5vsftp-1"><a href="#2-_u5B89_u88C5vsftp-1" class="headerlink" title="2.安装vsftp"></a>2.安装vsftp</h4><p>使用apt-get命令安装vsftp<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#apt-get install vsftpd -y</span><br></pre></td></tr></table></figure></p>
<h4 id="3-_u6DFB_u52A0ftp_u5E10_u53F7_u548C_u76EE_u5F55-1"><a href="#3-_u6DFB_u52A0ftp_u5E10_u53F7_u548C_u76EE_u5F55-1" class="headerlink" title="3.添加ftp帐号和目录"></a>3.添加ftp帐号和目录</h4><p>先检查一下nologin的位置，通常在/usr/sbin/nologin或者/sbin/nologin下。</p>
<p>使用下面的命令创建帐户，该命令指定了/alidata/www/wwwroot为用户pwftp的家目录，您可以自己定义帐户名和目录：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#useradd -d /alidata/www/wwwroot -s /sbin/nologin pwftp</span><br></pre></td></tr></table></figure></p>
<p>修改该帐户密码:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#passwd pwftp</span><br></pre></td></tr></table></figure></p>
<p>修改指定目录的权限<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#chown -R pwftp.pwftp /alidata/www/wwwroot</span><br></pre></td></tr></table></figure></p>
<h4 id="4-_u914D_u7F6Evsftp-1"><a href="#4-_u914D_u7F6Evsftp-1" class="headerlink" title="4.配置vsftp"></a>4.配置vsftp</h4><p>编辑vsftp配置文件，命令如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vi /etc/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>将配置文件中”anonymous_enable=YES “改为 “anonymous_enable=NO”</p>
<p>取消如下配置前的注释符号：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local_enable=YES&#10;&#10;write_enable=YES&#10;&#10;chroot_local_user=YES&#10;&#10;chroot_list_enable=YES&#10;&#10;chroot_list_file=/etc/vsftpd.chroot_list</span><br></pre></td></tr></table></figure></p>
<p>保存退出</p>
<p>编辑/etc/vsftpd.chroot_list文件，将ftp的帐户名添加进去，保存退出</p>
<h4 id="5-_u4FEE_u6539shell_u914D_u7F6E-1"><a href="#5-_u4FEE_u6539shell_u914D_u7F6E-1" class="headerlink" title="5.修改shell配置"></a>5.修改shell配置</h4><p>vi编辑/etc/shells，如果该文件里没有/usr/sbin/nologin或者/sbin/nologin（具体看当前系统配置）则追加进去</p>
<h4 id="6-_u91CD_u542Fvsftp_u670D_u52A1_u5E76_u6D4B_u8BD5_u767B_u5F55"><a href="#6-_u91CD_u542Fvsftp_u670D_u52A1_u5E76_u6D4B_u8BD5_u767B_u5F55" class="headerlink" title="6.重启vsftp服务并测试登录"></a>6.重启vsftp服务并测试登录</h4><p>使用命令启动vsftp服务：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#service vsftpd restart</span><br></pre></td></tr></table></figure></p>
<p>然后用帐号pwftp测试下是否可以登陆ftp。目录是/alidata/www/wwwroot。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/09/mt-recommend-practice/" itemprop="url">
                  美团推荐算法实践（转）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-02-09T15:58:58+08:00" content="2015-02-09">
              2015-02-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h3><p>推荐系统并不是新鲜的事物，在很久之前就存在，但是推荐系统真正进入人们的视野，并且作为一个重要的模块存在于各个互联网公司，还是近几年的事情。</p>
<p>随着互联网的深入发展，越来越多的信息在互联网上传播，产生了严重的信息过载。如果不采用一定的手段，用户很难从如此多的信息流中找到对自己有价值的信息。</p>
<p>解决信息过载有几种手段：一种是搜索，当用户有了明确的信息需求意图后，将意图转换为几个简短的词或者短语的组合（即query），然后将这些词或短语组合提交到相应的搜索引擎，再由搜索引擎在海量的信息库中检索出与query相关的信息返回给用户；另外一种是推荐，很多时候用户的意图并不是很明确，或者很难用清晰的语义表达，有时甚至连用户自己都不清楚自己的需求，这种情况下搜索就显得捉襟见肘了。尤其是近些年来，随着电子商务的兴起，用户并非一定是带着明确的购买意图去浏览，很多时候是去“逛”的，这种情景下解决信息过载，理解用户意图，为用户推送个性化的结果，推荐系统便是一种比较好的选择。</p>
<p>美团作为国内发展较快的o2o网站，有着大量的用户和丰富的用户行为，这些为推荐系统的应用和优化提供了不可或缺的条件，接下来介绍我们在推荐系统的构建和优化过程中的一些做法，与大家共享。</p>
<h3 id="u6846_u67B6"><a href="#u6846_u67B6" class="headerlink" title="框架"></a>框架</h3><p><img src="http://ww4.sinaimg.cn/mw690/6ba3371bjw1ep2yvz8d3lj20ea0dm753.jpg" alt=""><br>从框架的角度看，推荐系统基本可以分为数据层、触发层、融合过滤层和排序层。数据层包括数据生成和数据存储，主要是利用各种数据处理工具对原始日志进行清洗，处理成格式化的数据，落地到不同类型的存储系统中，供下游的算法和模型使用。候选集触发层主要是从用户的历史行为、实时行为、地理位置等角度利用各种触发策略产生推荐的候选集。候选集融合和过滤层有两个功能，一是对出发层产生的不同候选集进行融合，提高推荐策略的覆盖度和精度；另外还要承担一定的过滤职责，从产品、运营的角度确定一些人工规则，过滤掉不符合条件的item。排序层主要是利用机器学习的模型对触发层筛选出来的候选集进行重排序。</p>
<p>同时，对与候选集触发和重排序两层而言，为了效果迭代是需要频繁修改的两层，因此需要支持ABtest。为了支持高效率的迭代，我们对候选集触发和重排序两层进行了解耦，这两层的结果是正交的，因此可以分别进行对比试验，不会相互影响。同时在每一层的内部，我们会根据用户将流量划分为多份，支持多个策略同时在线对比。</p>
<h3 id="u6570_u636E_u5E94_u7528"><a href="#u6570_u636E_u5E94_u7528" class="headerlink" title="数据应用"></a>数据应用</h3><p>数据乃算法、模型之本。美团作为一个交易平台，同时具有快速增长的用户量，因此产生了海量丰富的用户行为数据。当然，不同类型的数据的价值和反映的用户意图的强弱也有所不同。</p>
<table>
<thead>
<tr>
<th>行为类别</th>
<th>行为详情</th>
</tr>
</thead>
<tbody>
<tr>
<td>主动行为数据</td>
<td>搜索、筛选、点击、收藏、下单、支付、评分</td>
</tr>
<tr>
<td>UGC</td>
<td>文本评价、上传图片  </td>
</tr>
<tr>
<td>负反馈数据</td>
<td>左滑删除、取消收藏、取消订单、退款、负评、低评</td>
</tr>
<tr>
<td>用户画像</td>
<td>用户人口属性、美团DNA、品类偏好、消费水平、工作地与居住地</td>
</tr>
</tbody>
</table>
<ol>
<li>用户主动行为数据记录了用户在美团平台上不同的环节的各种行为，这些行为一方面用于候选集触发算法（在下一部分介绍）中的离线计算（主要是浏览、下单），另外一方面，这些行为代表的意图的强弱不同，因此在训练重排序模型时可以针对不同的行为设定不同的回归目标值，以更细地刻画用户的行为强弱程度。此外，用户对deal的这些行为还可以作为重排序模型的交叉特征，用于模型的离线训练和在线预测。</li>
<li>负反馈数据反映了当前的结果可能在某些方面不能满足用户的需求，因此在后续的候选集触发过程中需要考虑对特定的因素进行过滤或者降权，降低负面因素再次出现的几率，提高用户体验；同时在重排序的模型训练中，负反馈数据可以作为不可多得的负例参与模型训练，这些负例要比那些展示后未点击、未下单的样本显著的多。</li>
<li>用户画像是刻画用户属性的基础数据，其中有些是直接获取的原始数据，有些是经过挖掘的二次加工数据，这些属性一方面可以用于候选集触发过程中对deal进行加权或降权，另外一方面可以作为重排序模型中的用户维度特征。</li>
<li>通过对UGC数据的挖掘可以提取出一些关键词，然后使用这些关键词给deal打标签，用于deal的个性化展示。</li>
</ol>
<h3 id="u7B56_u7565_u89E6_u53D1"><a href="#u7B56_u7565_u89E6_u53D1" class="headerlink" title="策略触发"></a>策略触发</h3><p>上文中我们提到了数据的重要性，但是数据的落脚点还是算法和模型。单纯的数据只是一些字节的堆积，我们必须通过对数据的清洗去除数据中的噪声，然后通过算法和模型学习其中的规律，才能将数据的价值最大化。在本节中，将介绍推荐候选集触发过程中用到的相关算法。</p>
<h4 id="1-__u534F_u540C_u8FC7_u6EE4"><a href="#1-__u534F_u540C_u8FC7_u6EE4" class="headerlink" title="1. 协同过滤"></a>1. 协同过滤</h4><p>提到推荐，就不得不说协同过滤，它几乎在每一个推荐系统中都会用到。基本的算法非常简单，但是要获得更好的效果，往往需要根据具体的业务做一些差异化的处理。</p>
<ul>
<li>清除作弊、刷单、代购等噪声数据。这些数据的存在会严重影响算法的效果，因此要在第一步的数据清洗中就将这些数据剔除。</li>
<li>合理选取训练数据。选取的训练数据的时间窗口不宜过长，当然也不能过短。具体的窗口期数值需要经过多次的实验来确定。同时可以考虑引入时间衰减，因为近期的用户行为更能反映用户接下来的行为动作。</li>
<li>user-based与item-based相结合。</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>群体/个体</th>
<th>计算代价</th>
<th>适用场景</th>
<th>冷启动</th>
<th>可解释性</th>
<th>实时性</th>
</tr>
</thead>
<tbody>
<tr>
<td>user-based</td>
<td>更依赖于当前用户相近的用户群体的社会化行为</td>
<td>适用于用户数较少的场合</td>
<td>时效性强，用户个性化兴趣不太显著的场合</td>
<td>新加入的物品能很快进入推荐列表</td>
<td>弱</td>
<td>用户新的行为不一定导致推荐结果的变化</td>
</tr>
<tr>
<td>item-based</td>
<td>更侧重用户自身的个体行为</td>
<td>适用于物品数较少的场合</td>
<td>长尾物品丰富，用户个性化需求强烈的场合</td>
<td>新加入的用户能很快得到推荐</td>
<td>强</td>
<td>用户新的行为一定导致推荐结果的变化 </td>
</tr>
</tbody>
</table>
<ul>
<li>尝试不同的相似度计算方法。在实践中，我们采用了一种称作loglikelihood ratio[1]的相似度计算方法。在mahout中，loglikelihood ratio也作为一种相似度计算方法被采用。<br>下表表示了Event A和Event B之间的相互关系，其中：<br>k11 ：Event A和Event B共现的次数<br>k12 ：Event B发生，Event A未发生的次数<br>k21 ：Event A发生，Event B未发生的次数<br>k22 ：Event A和Event B都不发生的次数</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Event A</th>
<th style="text-align:right">Event A</th>
</tr>
</thead>
<tbody>
<tr>
<td>Event B</td>
<td style="text-align:center">A and B together (k_11)</td>
<td style="text-align:right">B, but not A (k_12)</td>
</tr>
<tr>
<td>UGC</td>
<td style="text-align:center">A without B (k_21)</td>
<td style="text-align:right">Neither A nor B (k_22)</td>
</tr>
</tbody>
</table>
<p>则logLikelihoodRatio=2 * (matrixEntropy - rowEntropy - columnEntropy)</p>
<p>其中<br>rowEntropy = entropy(k11, k12) + entropy(k21, k22)<br>columnEntropy = entropy(k11, k21) + entropy(k12, k22)<br>matrixEntropy = entropy(k11, k12, k21, k22)<br>(entropy为几个元素组成的系统的香农熵)</p>
<h4 id="2-_location-based"><a href="#2-_location-based" class="headerlink" title="2. location-based"></a>2. location-based</h4><p>对于移动设备而言，与PC端最大的区别之一是移动设备的位置是经常发生变化的。不同的地理位置反映了不同的用户场景，在具体的业务中可以充分利用用户所处的地理位置。在推荐的候选集触发中，我们也会根据用户的实时地理位置、工作地、居住地等地理位置触发相应的策略。</p>
<ul>
<li>根据用户的历史消费、历史浏览等，挖掘出某一粒度的区域（比如商圈）内的区域消费热单和区域购买热单<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1ep2yvzrg2jj207705maa6.jpg" alt="区域消费热单"><br>区域消费热单<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1ep2yw0bkauj207b05y3yn.jpg" alt="区域购买热单"><br>区域购买热单</li>
<li>当新的线上用户请求到达时，根据用户的几个地理位置对相应地理位置的区域消费热单和区域购买热单进行加权，最终得到一个推荐列表。</li>
<li>此外，还可以根据用户出现的地理位置，采用协同过滤的方式计算用户的相似度。</li>
</ul>
<h4 id="3-_query-based"><a href="#3-_query-based" class="headerlink" title="3. query-based"></a>3. query-based</h4><p>搜索是一种强用户意图，比较明确的反应了用户的意愿，但是在很多情况下，因为各种各样的原因，没有形成最终的转换。尽管如此，我们认为，这种情景还是代表了一定的用户意愿，可以加以利用。具体做法如下：</p>
<ul>
<li>对用户过去一段时间的搜索无转换行为进行挖掘，计算每一个用户对不同query的权重。<br><img src="http://ww1.sinaimg.cn/mw690/6ba3371bjw1ep2yw1celej21kw0ibh00.jpg" alt=""></li>
<li>计算每个query下不同deal的权重。<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1ep2yw2g8eij21kw0jth0u.jpg" alt=""></li>
<li>当用户再次请求时，根据用户对不同query的权重及query下不同deal的权重进行加权，取出权重最大的TopN进行推荐。</li>
</ul>
<h4 id="4-_graph-based"><a href="#4-_graph-based" class="headerlink" title="4. graph-based"></a>4. graph-based</h4><p>对于协同过滤而言，user之间或者deal之间的图距离是两跳，对于更远距离的关系则不能考虑在内。而图算法可以打破这一限制，将user与deal的关系视作一个二部图，相互间的关系可以在图上传播。Simrank[2]是一种衡量对等实体相似度的图算法。它的基本思想是，如果两个实体与另外的相似实体有相关关系，那它们也是相似的，即相似性是可以传播的。</p>
<ul>
<li>Let s(A,B) denote the similarity between persons A and B, for A != B<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1ep33n545e7j208u01h3ye.jpg" alt=""><br>Let s(c,d) denote the similarity between items c and d, for c != d<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1ep33n5mgsqj208l01o746.jpg" alt=""><br>O(A),O(B): the set of out-neighbors for node A or node B<br>I(c),I(d): the set of in-neighbors for node c or node d</li>
<li>simrank的计算（采用矩阵迭代的方式）<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1ep33n6p247j2097051t8u.jpg" alt=""></li>
<li>计算得出相似度矩阵后，可以类似协同过滤用于线上推荐。</li>
</ul>
<h4 id="5-__u5B9E_u65F6_u7528_u6237_u884C_u4E3A"><a href="#5-__u5B9E_u65F6_u7528_u6237_u884C_u4E3A" class="headerlink" title="5. 实时用户行为"></a>5. 实时用户行为</h4><p>目前我们的业务会产生包括搜索、筛选、收藏、浏览、下单等丰富的用户行为，这些是我们进行效果优化的重要基础。我们当然希望每一个用户行为流都能到达转化的环节，但是事实上远非这样。</p>
<p>当用户产生了下单行为上游的某些行为时，会有相当一部分因为各种原因使行为流没有形成转化。但是，用户的这些上游行为对我们而言是非常重要的先验知识。很多情况下，用户当时没有转化并不代表用户对当前的item不感兴趣。当用户再次到达我们的推荐展位时，我们根据用户之前产生的先验行为理解并识别用户的真正意图，将符合用户意图的相关deal再次展现给用户，引导用户沿着行为流向下游行进，最终达到下单这个终极目标。</p>
<p>目前引入的实时用户行为包括：实时浏览、实时收藏。</p>
<h4 id="6-__u66FF_u8865_u7B56_u7565"><a href="#6-__u66FF_u8865_u7B56_u7565" class="headerlink" title="6. 替补策略"></a>6. 替补策略</h4><p>虽然我们有一系列基于用户历史行为的候选集触发算法，但对于部分新用户或者历史行为不太丰富的用户，上述算法触发的候选集太小，因此需要使用一些替补策略进行填充。</p>
<ul>
<li>热销单：在一定时间内销量最多的item，可以考虑时间衰减的影响等。</li>
<li>好评单：用户产生的评价中，评分较高的item。</li>
<li>城市单：满足基本的限定条件，在用户的请求城市内的。</li>
</ul>
<h3 id="u5B50_u7B56_u7565_u878D_u5408"><a href="#u5B50_u7B56_u7565_u878D_u5408" class="headerlink" title="子策略融合"></a>子策略融合</h3><p>为了结合不同触发算法的优点，同时提高候选集的多样性和覆盖率，需要将不同的触发算法融合在一起。常见的融合的方法有以下几种[3]：</p>
<ol>
<li>加权型：最简单的融合方法就是根据经验值对不同算法赋给不同的权重，对各个算法产生的候选集按照给定的权重进行加权，然后再按照权重排序。</li>
<li>分级型：优先采用效果好的算法，当产生的候选集大小不足以满足目标值时，再使用效果次好的算法，依此类推。</li>
<li>调制型：不同的算法按照不同的比例产生一定量的候选集，然后叠加产生最终总的候选集。</li>
<li>过滤型：当前的算法对前一级算法产生的候选集进行过滤，依此类推，候选集被逐级过滤，最终产生一个小而精的候选集合。</li>
</ol>
<p>目前我们使用的方法集成了调制和分级两种融合方法，不同的算法根据历史效果表现给定不同的候选集构成比例，同时优先采用效果好的算法触发，如果候选集不够大，再采用效果次之的算法触发，依此类推。</p>
<h3 id="u5019_u9009_u96C6_u91CD_u6392_u5E8F"><a href="#u5019_u9009_u96C6_u91CD_u6392_u5E8F" class="headerlink" title="候选集重排序"></a>候选集重排序</h3><p>如上所述，对于不同算法触发出来的候选集，只是根据算法的历史效果决定算法产生的item的位置显得有些简单粗暴，同时，在每个算法的内部，不同item的顺序也只是简单的由一个或者几个因素决定，这些排序的方法只能用于第一步的初选过程，最终的排序结果需要借助机器学习的方法，使用相关的排序模型，综合多方面的因素来确定。</p>
<h4 id="1-__u6A21_u578B"><a href="#1-__u6A21_u578B" class="headerlink" title="1. 模型"></a>1. 模型</h4><p>非线性模型能较好的捕捉特征中的非线性关系，但训练和预测的代价相对线性模型要高一些，这也导致了非线性模型的更新周期相对要长。反之，线性模型对特征的处理要求比较高，需要凭借领域知识和经验人工对特征做一些先期处理，但因为线性模型简单，在训练和预测时效率较高。因此在更新周期上也可以做的更短，还可以结合业务做一些在线学习的尝试。在我们的实践中，非线性模型和线性模型都有应用。</p>
<ul>
<li>非线性模型<br>目前我们主要采用了非线性的树模型Additive Groves[4]（简称AG），相对于线性模型，非线性模型可以更好的处理特征中的非线性关系，不必像线性模型那样在特征处理和特征组合上花费比较大的精力。AG是一个加性模型，由很多个Grove组成，不同的Grove之间进行bagging得出最后的预测结果，由此可以减小过拟合的影响。<br><img src="http://ww1.sinaimg.cn/mw690/6ba3371bjw1ep33n7fze6j20da0923yv.jpg" alt=""><br>每一个Grove有多棵树组成，在训练时每棵树的拟合目标为真实值与其他树预测结果之和之间的残差。当达到给定数目的树时，重新训练的树会逐棵替代以前的树。经过多次迭代后，达到收敛。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1ep33n7vhlbj20ha06mgm3.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/6ba3371bjw1ep33n8gjmzj20gw06mjrv.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1ep33n84bmbj20ha06m3z0.jpg" alt=""></li>
<li>线性模型<br>目前应用比较多的线性模型非Logistic Regression莫属了。为了能实时捕捉数据分布的变化，我们引入了online learning，接入实时数据流，使用google提出的FTRL[5]方法对模型进行在线更新。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1ep33n8pnrxj20ee08k0sz.jpg" alt=""><br>主要的步骤如下：</li>
<li>在线写特征向量到HBase</li>
<li>Storm解析实时点击和下单日志流，改写HBase中对应特征向量的label</li>
<li>通过FTRL更新模型权重</li>
<li>将新的模型参数应用于线上</li>
</ul>
<h4 id="2-__u6570_u636E"><a href="#2-__u6570_u636E" class="headerlink" title="2. 数据"></a>2. 数据</h4><ul>
<li>采样：对于点击率预估而言，正负样本严重不均衡，所以需要对负例做一些采样。</li>
<li>负例：正例一般是用户产生点击、下单等转换行为的样本，但是用户没有转换行为的样本是否就一定是负例呢？其实不然，很多展现其实用户根本没有看到，所以把这样样本视为负例是不合理的，也会影响模型的效果。比较常用的方法是skip-above，即用户点击的item位置以上的展现才可能视作负例。当然，上面的负例都是隐式的负反馈数据，除此之外，我们还有用户主动删除的显示负反馈数据，这些数据是高质量的负例。</li>
<li>去噪：对于数据中混杂的刷单等类作弊行为的数据，要将其排除出训练数据，否则会直接影响模型的效果。</li>
</ul>
<h4 id="3-__u7279_u5F81"><a href="#3-__u7279_u5F81" class="headerlink" title="3. 特征"></a>3. 特征</h4><p>在我们目前的重排序模型中，大概分为以下几类特征：</p>
<ul>
<li>deal(即团购单，下同)维度的特征：主要是deal本身的一些属性，包括价格、折扣、销量、评分、类别、点击率等</li>
<li>user维度的特征：包括用户等级、用户的人口属性、用户的客户端类型等</li>
<li>user、deal的交叉特征：包括用户对deal的点击、收藏、购买等\</li>
<li>距离特征：包括用户的实时地理位置、常去地理位置、工作地、居住地等与poi的距离</li>
</ul>
<p>对于非线性模型，上述特征可以直接使用；而对于线性模型，则需要对特征值做一些分桶、归一化等处理，使特征值成为0~1之间的连续值或01二值。</p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p>以数据为基础，用算法去雕琢，只有将二者有机结合，才会带来效果的提升。对我们而言，以下两个节点是我们优化过程中的里程碑：</p>
<ul>
<li>将候选集进行融合：提高了推荐的覆盖度、多样性和精度</li>
<li>引入重排序模型：解决了候选集增加以后deal之间排列顺序的问题<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1ep34d27wyej20i70a7dg8.jpg" alt=""></li>
</ul>
<p>以上是我们在实践中的一点总结，当然我们还有还多事情要做。we are still on the way!</p>
<p>Via:<a href="http://tech.meituan.com/mt-recommend-practice.html#rd" target="_blank" rel="external">美团推荐算法实践</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/08/Linux-vim-configuration/" itemprop="url">
                  CentOS vim 优化配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-02-08T16:58:58+08:00" content="2015-02-08">
              2015-02-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/工作/" itemprop="url" rel="index">
                    <span itemprop="name">工作</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>下面是精简的，没有插件的vim配置文件，保存到自己的vimrc文件就能使用。替换掉CentOS /etc 下的vimrc 即可。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34; &#26174;&#31034;&#30456;&#20851;  &#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;set shortmess=atI   &#34; &#21551;&#21160;&#30340;&#26102;&#20505;&#19981;&#26174;&#31034;&#37027;&#20010;&#25588;&#21161;&#20044;&#24178;&#36798;&#20799;&#31461;&#30340;&#25552;&#31034;  &#10;&#10;&#34;winpos 5 5          &#34; &#35774;&#23450;&#31383;&#21475;&#20301;&#32622;  &#10;&#10;&#34;set lines=40 columns=155    &#34; &#35774;&#23450;&#31383;&#21475;&#22823;&#23567;  &#10;&#10;&#34;set nu              &#34; &#26174;&#31034;&#34892;&#21495;  &#10;&#10;set go=             &#34; &#19981;&#35201;&#22270;&#24418;&#25353;&#38062;  &#10;&#10;&#34;color asmanian2     &#34; &#35774;&#32622;&#32972;&#26223;&#20027;&#39064;  &#10;&#10;set guifont=Courier_New:h10:cANSI   &#34; &#35774;&#32622;&#23383;&#20307;  &#10;&#10;&#34;syntax on           &#34; &#35821;&#27861;&#39640;&#20142;  &#10;&#10;autocmd InsertLeave * se nocul  &#34; &#29992;&#27973;&#33394;&#39640;&#20142;&#24403;&#21069;&#34892;  &#10;&#10;autocmd InsertEnter * se cul    &#34; &#29992;&#27973;&#33394;&#39640;&#20142;&#24403;&#21069;&#34892;  &#10;&#10;&#34;set ruler           &#34; &#26174;&#31034;&#26631;&#23610;  &#10;&#10;set showcmd         &#34; &#36755;&#20837;&#30340;&#21629;&#20196;&#26174;&#31034;&#20986;&#26469;&#65292;&#30475;&#30340;&#28165;&#26970;&#20123;  &#10;&#10;&#34;set cmdheight=1     &#34; &#21629;&#20196;&#34892;&#65288;&#22312;&#29366;&#24577;&#34892;&#19979;&#65289;&#30340;&#39640;&#24230;&#65292;&#35774;&#32622;&#20026;1  &#10;&#10;&#34;set whichwrap+=&#60;,&#62;,h,l   &#34; &#20801;&#35768;backspace&#21644;&#20809;&#26631;&#38190;&#36328;&#36234;&#34892;&#36793;&#30028;(&#19981;&#24314;&#35758;)  &#10;&#10;&#34;set scrolloff=3     &#34; &#20809;&#26631;&#31227;&#21160;&#21040;buffer&#30340;&#39030;&#37096;&#21644;&#24213;&#37096;&#26102;&#20445;&#25345;3&#34892;&#36317;&#31163;  &#10;&#10;set novisualbell    &#34; &#19981;&#35201;&#38378;&#28865;(&#19981;&#26126;&#30333;)  &#10;&#10;set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&#38;ff&#125;]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %&#123;strftime(\&#34;%d/%m/%y\ -\ %H:%M\&#34;)&#125;   &#34;&#29366;&#24577;&#34892;&#26174;&#31034;&#30340;&#20869;&#23481;  &#10;&#10;set laststatus=1    &#34; &#21551;&#21160;&#26174;&#31034;&#29366;&#24577;&#34892;(1),&#24635;&#26159;&#26174;&#31034;&#29366;&#24577;&#34892;(2)  &#10;&#10;set foldenable      &#34; &#20801;&#35768;&#25240;&#21472;  &#10;&#10;set foldmethod=manual   &#34; &#25163;&#21160;&#25240;&#21472;  &#10;&#10;&#34;set background=dark &#34;&#32972;&#26223;&#20351;&#29992;&#40657;&#33394; &#10;&#10;set nocompatible  &#34;&#21435;&#25481;&#35752;&#21388;&#30340;&#26377;&#20851;vi&#19968;&#33268;&#24615;&#27169;&#24335;&#65292;&#36991;&#20813;&#20197;&#21069;&#29256;&#26412;&#30340;&#19968;&#20123;bug&#21644;&#23616;&#38480;  &#10;&#10;&#34; &#26174;&#31034;&#20013;&#25991;&#24110;&#21161;&#10;&#10;if version &#62;= 603&#10;&#10;    set helplang=cn&#10;&#10;    set encoding=utf-8&#10;&#10;endif&#10;&#10;&#34; &#35774;&#32622;&#37197;&#33394;&#26041;&#26696;&#10;&#10;&#34;colorscheme murphy&#10;&#10;&#34;&#23383;&#20307; &#10;&#10;&#34;if (has(&#34;gui_running&#34;)) &#10;&#10;&#34;   set guifont=Bitstream\ Vera\ Sans\ Mono\ 10 &#10;&#10;&#34;endif &#10;&#10;&#10; &#10;set fencs=utf-8,ucs-bom,shift-jis,gb18030,gbk,gb2312,cp936&#10;&#10;set termencoding=utf-8&#10;&#10;set encoding=utf-8&#10;&#10;set fileencodings=ucs-bom,utf-8,cp936&#10;&#10;set fileencoding=utf-8&#10;&#10;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#26032;&#25991;&#20214;&#26631;&#39064;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#26032;&#24314;.c,.h,.sh,.java&#25991;&#20214;&#65292;&#33258;&#21160;&#25554;&#20837;&#25991;&#20214;&#22836; &#10;&#10;autocmd BufNewFile *.cpp,*.[ch],*.sh,*.java exec &#34;:call SetTitle()&#34; &#10;&#10;&#34;&#34;&#23450;&#20041;&#20989;&#25968;SetTitle&#65292;&#33258;&#21160;&#25554;&#20837;&#25991;&#20214;&#22836; &#10;&#10;func SetTitle() &#10;&#10;    &#34;&#22914;&#26524;&#25991;&#20214;&#31867;&#22411;&#20026;.sh&#25991;&#20214; &#10;&#10;    if &#38;filetype == &#39;sh&#39; &#10;&#10;        call setline(1,&#34;\#########################################################################&#34;) &#10;&#10;        call append(line(&#34;.&#34;), &#34;\# File Name: &#34;.expand(&#34;%&#34;)) &#10;&#10;        call append(line(&#34;.&#34;)+1, &#34;\# Author: ma6174&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+2, &#34;\# mail: ma6174@163.com&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+3, &#34;\# Created Time: &#34;.strftime(&#34;%c&#34;)) &#10;&#10;        call append(line(&#34;.&#34;)+4, &#34;\#########################################################################&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+5, &#34;\#!/bin/bash&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+6, &#34;&#34;) &#10;&#10;    else &#10;&#10;        call setline(1, &#34;/*************************************************************************&#34;) &#10;&#10;        call append(line(&#34;.&#34;), &#34;    &#62; File Name: &#34;.expand(&#34;%&#34;)) &#10;&#10;        call append(line(&#34;.&#34;)+1, &#34;    &#62; Author: ma6174&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+2, &#34;    &#62; Mail: ma6174@163.com &#34;) &#10;&#10;        call append(line(&#34;.&#34;)+3, &#34;    &#62; Created Time: &#34;.strftime(&#34;%c&#34;)) &#10;&#10;        call append(line(&#34;.&#34;)+4, &#34; ************************************************************************/&#34;) &#10;&#10;        call append(line(&#34;.&#34;)+5, &#34;&#34;)&#10;&#10;    endif&#10;&#10;    if &#38;filetype == &#39;cpp&#39;&#10;&#10;        call append(line(&#34;.&#34;)+6, &#34;#include&#60;iostream&#62;&#34;)&#10;&#10;        call append(line(&#34;.&#34;)+7, &#34;using namespace std;&#34;)&#10;&#10;        call append(line(&#34;.&#34;)+8, &#34;&#34;)&#10;&#10;    endif&#10;&#10;    if &#38;filetype == &#39;c&#39;&#10;&#10;        call append(line(&#34;.&#34;)+6, &#34;#include&#60;stdio.h&#62;&#34;)&#10;&#10;        call append(line(&#34;.&#34;)+7, &#34;&#34;)&#10;&#10;    endif&#10;&#10;    &#34;&#26032;&#24314;&#25991;&#20214;&#21518;&#65292;&#33258;&#21160;&#23450;&#20301;&#21040;&#25991;&#20214;&#26411;&#23614;&#10;&#10;    autocmd BufNewFile * normal G&#10;&#10;endfunc &#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#38190;&#30424;&#21629;&#20196;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#10;&#10;nmap &#60;leader&#62;w :w!&#60;cr&#62;&#10;&#10;nmap &#60;leader&#62;f :find&#60;cr&#62;&#10;&#10;&#10;&#10;&#34; &#26144;&#23556;&#20840;&#36873;+&#22797;&#21046; ctrl+a&#10;&#10;map &#60;C-A&#62; ggVGY&#10;&#10;map! &#60;C-A&#62; &#60;Esc&#62;ggVGY&#10;&#10;map &#60;F12&#62; gg=G&#10;&#10;&#34; &#36873;&#20013;&#29366;&#24577;&#19979; Ctrl+c &#22797;&#21046;&#10;&#10;vmap &#60;C-c&#62; &#34;+y&#10;&#10;&#34;&#21435;&#31354;&#34892;  &#10;&#10;nnoremap &#60;F2&#62; :g/^\s*$/d&#60;CR&#62; &#10;&#10;&#34;&#27604;&#36739;&#25991;&#20214;  &#10;&#10;nnoremap &#60;C-F2&#62; :vert diffsplit &#10;&#10;&#34;&#26032;&#24314;&#26631;&#31614;  &#10;&#10;map &#60;M-F2&#62; :tabnew&#60;CR&#62;  &#10;&#10;&#34;&#21015;&#20986;&#24403;&#21069;&#30446;&#24405;&#25991;&#20214;  &#10;&#10;map &#60;F3&#62; :tabnew .&#60;CR&#62;  &#10;&#10;&#34;&#25171;&#24320;&#26641;&#29366;&#25991;&#20214;&#30446;&#24405;  &#10;&#10;map &#60;C-F3&#62; \be  &#10;&#10;&#34;C&#65292;C++ &#25353;F5&#32534;&#35793;&#36816;&#34892;&#10;&#10;map &#60;F5&#62; :call CompileRunGcc()&#60;CR&#62;&#10;&#10;func! CompileRunGcc()&#10;&#10;    exec &#34;w&#34;&#10;&#10;    if &#38;filetype == &#39;c&#39;&#10;&#10;        exec &#34;!g++ % -o %&#60;&#34;&#10;&#10;        exec &#34;! ./%&#60;&#34;&#10;&#10;    elseif &#38;filetype == &#39;cpp&#39;&#10;&#10;        exec &#34;!g++ % -o %&#60;&#34;&#10;&#10;        exec &#34;! ./%&#60;&#34;&#10;&#10;    elseif &#38;filetype == &#39;java&#39; &#10;&#10;        exec &#34;!javac %&#34; &#10;&#10;        exec &#34;!java %&#60;&#34;&#10;&#10;    elseif &#38;filetype == &#39;sh&#39;&#10;&#10;        :!./%&#10;&#10;    endif&#10;&#10;endfunc&#10;&#10;&#34;C,C++&#30340;&#35843;&#35797;&#10;&#10;map &#60;F8&#62; :call Rungdb()&#60;CR&#62;&#10;&#10;func! Rungdb()&#10;&#10;    exec &#34;w&#34;&#10;&#10;    exec &#34;!g++ % -g -o %&#60;&#34;&#10;&#10;    exec &#34;!gdb ./%&#60;&#34;&#10;&#10;endfunc&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#34;&#23454;&#29992;&#35774;&#32622;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34; &#35774;&#32622;&#24403;&#25991;&#20214;&#34987;&#25913;&#21160;&#26102;&#33258;&#21160;&#36733;&#20837;&#10;&#10;set autoread&#10;&#10;&#34; quickfix&#27169;&#24335;&#10;&#10;autocmd FileType c,cpp map &#60;buffer&#62; &#60;leader&#62;&#60;space&#62; :w&#60;cr&#62;:make&#60;cr&#62;&#10;&#10;&#34;&#20195;&#30721;&#34917;&#20840; &#10;&#10;set completeopt=preview,menu &#10;&#10;&#34;&#20801;&#35768;&#25554;&#20214;  &#10;&#10;filetype plugin on&#10;&#10;&#34;&#20849;&#20139;&#21098;&#36148;&#26495;  &#10;&#10;set clipboard+=unnamed &#10;&#10;&#34;&#20174;&#19981;&#22791;&#20221;  &#10;&#10;set nobackup&#10;&#10;&#34;make &#36816;&#34892;&#10;&#10;:set makeprg=g++\ -Wall\ \ %&#10;&#10;&#34;&#33258;&#21160;&#20445;&#23384;&#10;&#10;set autowrite&#10;&#10;set ruler                   &#34; &#25171;&#24320;&#29366;&#24577;&#26639;&#26631;&#23610;&#10;&#10;set cursorline              &#34; &#31361;&#20986;&#26174;&#31034;&#24403;&#21069;&#34892;&#10;&#10;set magic                   &#34; &#35774;&#32622;&#39764;&#26415;&#10;&#10;set guioptions-=T           &#34; &#38544;&#34255;&#24037;&#20855;&#26639;&#10;&#10;set guioptions-=m           &#34; &#38544;&#34255;&#33756;&#21333;&#26639;&#10;&#10;&#34;set statusline=\ %&#60;%F[%1*%M%*%n%R%H]%=\ %y\ %0(%&#123;&#38;fileformat&#125;\ %&#123;&#38;encoding&#125;\ %c:%l/%L%)\&#10;&#10;&#34; &#35774;&#32622;&#22312;&#29366;&#24577;&#34892;&#26174;&#31034;&#30340;&#20449;&#24687;&#10;&#10;set foldcolumn=0&#10;&#10;set foldmethod=indent &#10;&#10;set foldlevel=3 &#10;&#10;set foldenable              &#34; &#24320;&#22987;&#25240;&#21472;&#10;&#10;&#34; &#19981;&#35201;&#20351;&#29992;vi&#30340;&#38190;&#30424;&#27169;&#24335;&#65292;&#32780;&#26159;vim&#33258;&#24049;&#30340;&#10;&#10;set nocompatible&#10;&#10;&#34; &#35821;&#27861;&#39640;&#20142;&#10;&#10;set syntax=on&#10;&#10;&#34; &#21435;&#25481;&#36755;&#20837;&#38169;&#35823;&#30340;&#25552;&#31034;&#22768;&#38899;&#10;&#10;set noeb&#10;&#10;&#34; &#22312;&#22788;&#29702;&#26410;&#20445;&#23384;&#25110;&#21482;&#35835;&#25991;&#20214;&#30340;&#26102;&#20505;&#65292;&#24377;&#20986;&#30830;&#35748;&#10;&#10;set confirm&#10;&#10;&#34; &#33258;&#21160;&#32553;&#36827;&#10;&#10;set autoindent&#10;&#10;set cindent&#10;&#10;&#34; Tab&#38190;&#30340;&#23485;&#24230;&#10;&#10;set tabstop=4&#10;&#10;&#34; &#32479;&#19968;&#32553;&#36827;&#20026;4&#10;&#10;set softtabstop=4&#10;&#10;set shiftwidth=4&#10;&#10;&#34; &#19981;&#35201;&#29992;&#31354;&#26684;&#20195;&#26367;&#21046;&#34920;&#31526;&#10;&#10;set noexpandtab&#10;&#10;&#34; &#22312;&#34892;&#21644;&#27573;&#24320;&#22987;&#22788;&#20351;&#29992;&#21046;&#34920;&#31526;&#10;&#10;set smarttab&#10;&#10;&#34; &#26174;&#31034;&#34892;&#21495;&#10;&#10;set number&#10;&#10;&#34; &#21382;&#21490;&#35760;&#24405;&#25968;&#10;&#10;set history=1000&#10;&#10;&#34;&#31105;&#27490;&#29983;&#25104;&#20020;&#26102;&#25991;&#20214;&#10;&#10;set nobackup&#10;&#10;set noswapfile&#10;&#10;&#34;&#25628;&#32034;&#24573;&#30053;&#22823;&#23567;&#20889;&#10;&#10;set ignorecase&#10;&#10;&#34;&#25628;&#32034;&#36880;&#23383;&#31526;&#39640;&#20142;&#10;&#10;set hlsearch&#10;&#10;set incsearch&#10;&#10;&#34;&#34892;&#20869;&#26367;&#25442;&#10;&#10;set gdefault&#10;&#10;&#34;&#32534;&#30721;&#35774;&#32622;&#10;&#10;set enc=utf-8&#10;&#10;set fencs=utf-8,ucs-bom,shift-jis,gb18030,gbk,gb2312,cp936&#10;&#10;&#34;&#35821;&#35328;&#35774;&#32622;&#10;&#10;set langmenu=zh_CN.UTF-8&#10;&#10;set helplang=cn&#10;&#10;&#34; &#25105;&#30340;&#29366;&#24577;&#34892;&#26174;&#31034;&#30340;&#20869;&#23481;&#65288;&#21253;&#25324;&#25991;&#20214;&#31867;&#22411;&#21644;&#35299;&#30721;&#65289;&#10;&#10;&#34;set statusline=%F%m%r%h%w\ [FORMAT=%&#123;&#38;ff&#125;]\ [TYPE=%Y]\ [POS=%l,%v][%p%%]\ %&#123;strftime(\&#34;%d/%m/%y\ -\ %H:%M\&#34;)&#125;&#10;&#10;&#34;set statusline=[%F]%y%r%m%*%=[Line:%l/%L,Column:%c][%p%%]&#10;&#10;&#34; &#24635;&#26159;&#26174;&#31034;&#29366;&#24577;&#34892;&#10;&#10;set laststatus=2&#10;&#10;&#34; &#21629;&#20196;&#34892;&#65288;&#22312;&#29366;&#24577;&#34892;&#19979;&#65289;&#30340;&#39640;&#24230;&#65292;&#40664;&#35748;&#20026;1&#65292;&#36825;&#37324;&#26159;2&#10;&#10;set cmdheight=2&#10;&#10;&#34; &#20390;&#27979;&#25991;&#20214;&#31867;&#22411;&#10;&#10;filetype on&#10;&#10;&#34; &#36733;&#20837;&#25991;&#20214;&#31867;&#22411;&#25554;&#20214;&#10;&#10;filetype plugin on&#10;&#10;&#34; &#20026;&#29305;&#23450;&#25991;&#20214;&#31867;&#22411;&#36733;&#20837;&#30456;&#20851;&#32553;&#36827;&#25991;&#20214;&#10;&#10;filetype indent on&#10;&#10;&#34; &#20445;&#23384;&#20840;&#23616;&#21464;&#37327;&#10;&#10;set viminfo+=!&#10;&#10;&#34; &#24102;&#26377;&#22914;&#19979;&#31526;&#21495;&#30340;&#21333;&#35789;&#19981;&#35201;&#34987;&#25442;&#34892;&#20998;&#21106;&#10;&#10;set iskeyword+=_,$,@,%,#,-&#10;&#10;&#34; &#23383;&#31526;&#38388;&#25554;&#20837;&#30340;&#20687;&#32032;&#34892;&#25968;&#30446;&#10;&#10;set linespace=0&#10;&#10;&#34; &#22686;&#24378;&#27169;&#24335;&#20013;&#30340;&#21629;&#20196;&#34892;&#33258;&#21160;&#23436;&#25104;&#25805;&#20316;&#10;&#10;set wildmenu&#10;&#10;&#34; &#20351;&#22238;&#26684;&#38190;&#65288;backspace&#65289;&#27491;&#24120;&#22788;&#29702;indent, eol, start&#31561;&#10;&#10;set backspace=2&#10;&#10;&#34; &#20801;&#35768;backspace&#21644;&#20809;&#26631;&#38190;&#36328;&#36234;&#34892;&#36793;&#30028;&#10;&#10;set whichwrap+=&#60;,&#62;,h,l&#10;&#10;&#34; &#21487;&#20197;&#22312;buffer&#30340;&#20219;&#20309;&#22320;&#26041;&#20351;&#29992;&#40736;&#26631;&#65288;&#31867;&#20284;office&#20013;&#22312;&#24037;&#20316;&#21306;&#21452;&#20987;&#40736;&#26631;&#23450;&#20301;&#65289;&#10;&#10;set mouse=a&#10;&#10;set selection=exclusive&#10;&#10;set selectmode=mouse,key&#10;&#10;&#34; &#36890;&#36807;&#20351;&#29992;: commands&#21629;&#20196;&#65292;&#21578;&#35785;&#25105;&#20204;&#25991;&#20214;&#30340;&#21738;&#19968;&#34892;&#34987;&#25913;&#21464;&#36807;&#10;&#10;set report=0&#10;&#10;&#34; &#22312;&#34987;&#20998;&#21106;&#30340;&#31383;&#21475;&#38388;&#26174;&#31034;&#31354;&#30333;&#65292;&#20415;&#20110;&#38405;&#35835;&#10;&#10;set fillchars=vert:\ ,stl:\ ,stlnc:\&#10;&#10;&#34; &#39640;&#20142;&#26174;&#31034;&#21305;&#37197;&#30340;&#25324;&#21495;&#10;&#10;set showmatch&#10;&#10;&#34; &#21305;&#37197;&#25324;&#21495;&#39640;&#20142;&#30340;&#26102;&#38388;&#65288;&#21333;&#20301;&#26159;&#21313;&#20998;&#20043;&#19968;&#31186;&#65289;&#10;&#10;set matchtime=1&#10;&#10;&#34; &#20809;&#26631;&#31227;&#21160;&#21040;buffer&#30340;&#39030;&#37096;&#21644;&#24213;&#37096;&#26102;&#20445;&#25345;3&#34892;&#36317;&#31163;&#10;&#10;set scrolloff=3&#10;&#10;&#34; &#20026;C&#31243;&#24207;&#25552;&#20379;&#33258;&#21160;&#32553;&#36827;&#10;&#10;set smartindent&#10;&#10;&#34; &#39640;&#20142;&#26174;&#31034;&#26222;&#36890;txt&#25991;&#20214;&#65288;&#38656;&#35201;txt.vim&#33050;&#26412;&#65289;&#10;&#10;au BufRead,BufNewFile *  setfiletype txt&#10;&#10;&#34;&#33258;&#21160;&#34917;&#20840;&#10;&#10;:inoremap ( ()&#60;ESC&#62;i&#10;&#10;:inoremap ) &#60;c-r&#62;=ClosePair(&#39;)&#39;)&#60;CR&#62;&#10;&#10;:inoremap &#123; &#123;&#60;CR&#62;&#125;&#60;ESC&#62;O&#10;&#10;:inoremap &#125; &#60;c-r&#62;=ClosePair(&#39;&#125;&#39;)&#60;CR&#62;&#10;&#10;:inoremap [ []&#60;ESC&#62;i&#10;&#10;:inoremap ] &#60;c-r&#62;=ClosePair(&#39;]&#39;)&#60;CR&#62;&#10;&#10;:inoremap &#34; &#34;&#34;&#60;ESC&#62;i&#10;&#10;:inoremap &#39; &#39;&#39;&#60;ESC&#62;i&#10;&#10;function! ClosePair(char)&#10;&#10;    if getline(&#39;.&#39;)[col(&#39;.&#39;) - 1] == a:char&#10;&#10;        return &#34;\&#60;Right&#62;&#34;&#10;&#10;    else&#10;&#10;        return a:char&#10;&#10;    endif&#10;&#10;endfunction&#10;&#10;filetype plugin indent on &#10;&#10;&#34;&#25171;&#24320;&#25991;&#20214;&#31867;&#22411;&#26816;&#27979;, &#21152;&#20102;&#36825;&#21477;&#25165;&#21487;&#20197;&#29992;&#26234;&#33021;&#34917;&#20840;&#10;&#10;set completeopt=longest,menu&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34; CTags&#30340;&#35774;&#23450;  &#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;let Tlist_Sort_Type = &#34;name&#34;    &#34; &#25353;&#29031;&#21517;&#31216;&#25490;&#24207;  &#10;&#10;let Tlist_Use_Right_Window = 1  &#34; &#22312;&#21491;&#20391;&#26174;&#31034;&#31383;&#21475;  &#10;&#10;let Tlist_Compart_Format = 1    &#34; &#21387;&#32553;&#26041;&#24335;  &#10;&#10;let Tlist_Exist_OnlyWindow = 1  &#34; &#22914;&#26524;&#21482;&#26377;&#19968;&#20010;buffer&#65292;kill&#31383;&#21475;&#20063;kill&#25481;buffer  &#10;&#10;let Tlist_File_Fold_Auto_Close = 0  &#34; &#19981;&#35201;&#20851;&#38381;&#20854;&#20182;&#25991;&#20214;&#30340;tags  &#10;&#10;let Tlist_Enable_Fold_Column = 0    &#34; &#19981;&#35201;&#26174;&#31034;&#25240;&#21472;&#26641;  &#10;&#10;autocmd FileType java set tags+=D:\tools\java\tags  &#10;&#10;&#34;autocmd FileType h,cpp,cc,c set tags+=D:\tools\cpp\tags  &#10;&#10;&#34;let Tlist_Show_One_File=1            &#34;&#19981;&#21516;&#26102;&#26174;&#31034;&#22810;&#20010;&#25991;&#20214;&#30340;tag&#65292;&#21482;&#26174;&#31034;&#24403;&#21069;&#25991;&#20214;&#30340;&#10;&#10;&#34;&#35774;&#32622;tags  &#10;&#10;set tags=tags  &#10;&#10;&#34;set autochdir &#10;&#10;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#20854;&#20182;&#19996;&#19996;&#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#10;&#10;&#34;&#40664;&#35748;&#25171;&#24320;Taglist &#10;&#10;let Tlist_Auto_Open=1 &#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34; &#10;&#10;&#34; Tag list (ctags) &#10;&#10;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34; &#10;&#10;let Tlist_Ctags_Cmd = &#39;/usr/bin/ctags&#39; &#10;&#10;let Tlist_Show_One_File = 1 &#34;&#19981;&#21516;&#26102;&#26174;&#31034;&#22810;&#20010;&#25991;&#20214;&#30340;tag&#65292;&#21482;&#26174;&#31034;&#24403;&#21069;&#25991;&#20214;&#30340; &#10;&#10;let Tlist_Exit_OnlyWindow = 1 &#34;&#22914;&#26524;taglist&#31383;&#21475;&#26159;&#26368;&#21518;&#19968;&#20010;&#31383;&#21475;&#65292;&#21017;&#36864;&#20986;vim &#10;&#10;let Tlist_Use_Right_Window = 1 &#34;&#22312;&#21491;&#20391;&#31383;&#21475;&#20013;&#26174;&#31034;taglist&#31383;&#21475;&#10;&#10;&#34; minibufexpl&#25554;&#20214;&#30340;&#19968;&#33324;&#35774;&#32622;&#10;&#10;let g:miniBufExplMapWindowNavVim = 1&#10;&#10;let g:miniBufExplMapWindowNavArrows = 1&#10;&#10;let g:miniBufExplMapCTabSwitchBufs = 1&#10;let g:miniBufExplModSelTarget = 1</span><br></pre></td></tr></table></figure></p>
<p>附：vimrc配置文件下载地址：<a href="http://pan.baidu.com/s/1eQtOVNs" target="_blank" rel="external">下载地址</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/01/about-snow/" itemprop="url">
                  雪，很...
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-02-01T08:18:18+08:00" content="2015-02-01">
              2015-02-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/音十文集/" itemprop="url" rel="index">
                    <span itemprop="name">音十文集</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>今天竟然意外的下雪了，而且很大。观雪有感，作文记之。<br>雪，很冬天。<br>冬天因雪而不再凌厉肃杀。<br>高骈说：“六月飞花入户时，坐看青竹变琼枝。”<br>雪，很北国。<br>北国因雪而变得温情江南。<br>元稹说，“才见岭头似盖，已惊岩下雪如尘；千峰笋石千株玉，万树松萝万朵云。”<br>雪很边疆，很羁旅。<br>岑参说，“山回路转不见君，雪上空留马行处。”<br>韩愈说，“云横秦岭家何在，雪拥蓝关马不前。”<br>雪，很梅花。<br>卢梅坡说，“梅须逊雪三分白，雪却输梅一段香。”<br>吕本中说，“雪似梅花，梅花似雪，似和不似都奇绝。”<br>雪，很春意。<br>岑参说，“忽如一夜春风来，千树万树梨花开。”<br>欧阳修说，“雪消门外千山绿，花发江南二月晴。”<br>雪，很陶渊明。<br>柳宗元说，“千山鸟飞绝，万径人踪灭；孤舟蓑笠翁，独钓寒江雪。”<br>江莘说，“谁家残雪，何处孤烟，向一溪桥，一茅店，一渔船。”<br>雪，很李白。<br>李白说，“燕山雪花大如席，纷纷吹落轩辕台。”<br>李白又说，“地白风色寒，雪花大如手。”<br>雪，很名士。<br>刘贺说，“百泉冻皆咽，我吟更真切；半夜倚乔桥，不觉满衣雪。”<br>王安石说，“墙角数枝梅，凌寒独自开。遥知不是雪，为有暗香来。”<br>雪，很侠客。<br>王维说，“草枯鹰眼疾，雪尽马蹄轻。”<br>张元作说，“战退玉龙三百万，败鳞残甲满天飞。”<br>雪，很才女。<br>谢道蕴说，雪乃“柳絮因风起”。<br>沈佩说，“帘外雪初飘，翠幌香凝火未消。独坐夜寒人欲倦，迢迢，梦断更残被寂寥。”<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1eow5mk7o0fj216h1kwe2k.jpg" alt="WuHan"><br><img src="http://ww4.sinaimg.cn/mw690/6ba3371bjw1eow5mluwlaj216h1kw7rl.jpg" alt="WuHan"><br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1eow5mnuy5tj216h1kwnfo.jpg" alt="WuHan"><br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1eow5mpt02oj216h1kw4qp.jpg" alt="Hometown"><br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1eow5mtxswzj216h1kwe81.jpg" alt="Hometown"><br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bgw1eow5s0e34vj21kw16h4qp.jpg" alt="Hometown"></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/29/Linux-inodes-full/" itemprop="url">
                  Linux索引节点(Inode)用满导致空间不足
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-29T16:58:58+08:00" content="2015-01-29">
              2015-01-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/工作/" itemprop="url" rel="index">
                    <span itemprop="name">工作</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u4E00_u3001_u95EE_u9898_u51FA_u73B0"><a href="#u4E00_u3001_u95EE_u9898_u51FA_u73B0" class="headerlink" title="一、问题出现"></a>一、问题出现</h3><p>在创建新目录和文件是提示“no space left on device”！按照以前的情况，很有可能是服务器空间又被塞满了，通过命令查看，发现还有剩余。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bgw1eov54sdut5j20b402dmxn.jpg" alt=""><br>再用df -i查看了一下/分区的索引节点(inode)，发现已经用满(已用=100%)，导致系统无法创建新目录和文件。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bgw1eox43osx8zj20cl02rjry.jpg" alt=""></p>
<h3 id="u4E8C_u3001_u95EE_u9898_u4EA7_u751F_u539F_u56E0"><a href="#u4E8C_u3001_u95EE_u9898_u4EA7_u751F_u539F_u56E0" class="headerlink" title="二、问题产生原因"></a>二、问题产生原因</h3><p>Inode译成中文就是索引节点，每个存储设备（例如硬盘）或存储设备的分区被格式化为文件系统后，应该有两部份，一部份是inode，另一部份是 Block，Block是用来存储数据用的。而inode呢，就是用来存储这些数据的信息，这些信息包括文件大小、属主、归属的用户组、读写权限等。 inode为每个文件进行信息索引，所以就有了inode的数值。操作系统根据指令，能通过inode值最快的找到相对应的文件。<br>而这台服务器的Block虽然还有剩余，但inode已经用满，因此在创建新目录或文件时，系统提示磁盘空间不足。<br>Inode的数量是有限制的，每个文件对应一个Inode，那么如何查看inode的最大数量呢？<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bgw1eox43osx8zj20cl02rjry.jpg" alt=""><br>可以看到Inode的总量，已经使用的Inode数量，和剩余数量。<br>如果watch -n 1 “df -i”一下， 然后去创建一个文件， 会发现已用的加一，未用的减一<br>简单了解下Inode在文件系统中的地位：<br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bgw1eov54uh4dlj20h0080wev.jpg" alt=""><br>Linux会为每一个文件分配一个唯一的inode节点。在linux中，文件的文件名、文件属性、文件内容是分别存储的：文件名存放在目录项（即 dentry）中，文件属性存放在inode中，文件内容存放在block中。Linux在查找文件时，首先先读取dentry，dentry中存储的文 件名和inode编号的一个映射表， 根据这个表找到inode编号，再根据inode找到磁盘中的文件。<br>可以用ls -i查看文件对应的inode编号， 也可以直接stat一个文件， 会有很全的信息。</p>
<h3 id="u89E3_u51B3_u65B9_u6848"><a href="#u89E3_u51B3_u65B9_u6848" class="headerlink" title="解决方案"></a>解决方案</h3><p>删除/data/cache目录中的部分文件，释放出/data分区的一部分inode。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ23b44crpgZ /]# find /var/spool/clientmqueue -type f -print -exec rm -f &#123;&#125; \;</span><br></pre></td></tr></table></figure></p>
<p>这个命令中 /var/spool/clientmqueue 是要删除的文件所在的目录 -type f这个参数限定find只查找普通文件（即不是管道文件，不是块文件，不是链接文件，不是目录等），防止误删除系统文件。<br>原因分析：系统中有用户开启了cron，而cron中执行的程序有输出内容，输出内容会以邮件形式发给cron的用户，而sendmail没有启动所以就产生了这些文件；<br>解决办法:<br>将crontab里面的命令后面加上  &gt; /dev/null 2&gt;&amp;1 或者crontab里面的命令后面加上  &gt; /dev/null</p>
<p>参考文档：</p>
<ol>
<li><a href="http://www.cnblogs.com/shapherd/archive/2012/02/07/2341638.html" title="linux中的inode简单介绍" target="_blank" rel="external">linux中的inode简单介绍</a></li>
<li><a href="http://blog.s135.com/post/295/" title="Linux索引节点(inode)用满导致的一次故障【原创】" target="_blank" rel="external">Linux索引节点(inode)用满导致的一次故障【原创】</a></li>
</ol>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/28/mount-data-disks-to-linux/" itemprop="url">
                  Linux 系统挂载数据盘
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-28T18:58:58+08:00" content="2015-01-28">
              2015-01-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/工作/" itemprop="url" rel="index">
                    <span itemprop="name">工作</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>适用系统：Linux（Redhat , CentOS，Debian，Ubuntu）<br><strong>Linux的云服务器数据盘未做分区和格式化，可以根据以下步骤进行分区以及格式化操作。<br>下面的操作将会把数据盘划分为一个分区来使用。</strong></p>
<h3 id="1_u3001_u67E5_u770B_u6570_u636E_u76D8_u3002_u5728_u6CA1_u6709_u5206_u533A_u548C_u683C_u5F0F_u5316_u6570_u636E_u76D8_u4E4B_u524D_uFF0C_u4F7F_u7528__u201Cdf__u2013h_u201D_u547D_u4EE4_uFF0C_u662F_u65E0_u6CD5_u770B_u5230_u6570_u636E_u76D8_u7684_uFF0C_u53EF_u4EE5_u4F7F_u7528_u201Cfdisk_-l_u201D_u547D_u4EE4_u67E5_u770B_u3002_u5982_u4E0B_u56FE_uFF1A"><a href="#1_u3001_u67E5_u770B_u6570_u636E_u76D8_u3002_u5728_u6CA1_u6709_u5206_u533A_u548C_u683C_u5F0F_u5316_u6570_u636E_u76D8_u4E4B_u524D_uFF0C_u4F7F_u7528__u201Cdf__u2013h_u201D_u547D_u4EE4_uFF0C_u662F_u65E0_u6CD5_u770B_u5230_u6570_u636E_u76D8_u7684_uFF0C_u53EF_u4EE5_u4F7F_u7528_u201Cfdisk_-l_u201D_u547D_u4EE4_u67E5_u770B_u3002_u5982_u4E0B_u56FE_uFF1A" class="headerlink" title="1、查看数据盘。在没有分区和格式化数据盘之前，使用 “df –h”命令，是无法看到数据盘的，可以使用“fdisk -l”命令查看。如下图："></a>1、查看数据盘。在没有分区和格式化数据盘之前，使用 “df –h”命令，是无法看到数据盘的，可以使用“fdisk -l”命令查看。如下图：</h3><p><img src="http://ww2.sinaimg.cn/mw690/6ba3371bgw1eoqj4s014wj20e10azq5q.jpg" alt=""></p>
<p>友情提示：<em>若您执行fdisk -l命令，发现没有 /dev/xvdb 标明您的云服务无数据盘，那么您无需进行挂载，此时该教程对您不适用。</em></p>
<h3 id="2_u3001_u5BF9_u6570_u636E_u76D8_u8FDB_u884C_u5206_u533A_u3002_u6267_u884C_u201Cfdisk_-S_56_/dev/xvdb_u201D_u547D_u4EE4_uFF0C_u5BF9_u6570_u636E_u76D8_u8FDB_u884C_u5206_u533A_uFF1B_u6839_u636E_u63D0_u793A_uFF0C_u4F9D_u6B21_u8F93_u5165_u201Cn_u201D_uFF0C_u201Cp_u201D_u201C1_u201D_uFF0C_u4E24_u6B21_u56DE_u8F66_uFF0C_u201Cwq_u201D_uFF0C_u5206_u533A_u5C31_u5F00_u59CB_u4E86_uFF0C_u5F88_u5FEB_u5C31_u4F1A_u5B8C_u6210_u3002"><a href="#2_u3001_u5BF9_u6570_u636E_u76D8_u8FDB_u884C_u5206_u533A_u3002_u6267_u884C_u201Cfdisk_-S_56_/dev/xvdb_u201D_u547D_u4EE4_uFF0C_u5BF9_u6570_u636E_u76D8_u8FDB_u884C_u5206_u533A_uFF1B_u6839_u636E_u63D0_u793A_uFF0C_u4F9D_u6B21_u8F93_u5165_u201Cn_u201D_uFF0C_u201Cp_u201D_u201C1_u201D_uFF0C_u4E24_u6B21_u56DE_u8F66_uFF0C_u201Cwq_u201D_uFF0C_u5206_u533A_u5C31_u5F00_u59CB_u4E86_uFF0C_u5F88_u5FEB_u5C31_u4F1A_u5B8C_u6210_u3002" class="headerlink" title="2、对数据盘进行分区。执行“fdisk -S 56 /dev/xvdb”命令，对数据盘进行分区；根据提示，依次输入“n”，“p”“1”，两次回车，“wq”，分区就开始了，很快就会完成。"></a>2、对数据盘进行分区。执行“fdisk -S 56 /dev/xvdb”命令，对数据盘进行分区；根据提示，依次输入“n”，“p”“1”，两次回车，“wq”，分区就开始了，很快就会完成。</h3><p><img src="http://ww3.sinaimg.cn/mw690/6ba3371bgw1eoqjf4mc95j20i80dbtbg.jpg" alt=""></p>
<p><em>注：有可能在格式化分区的时候报一下错误：Partition 1 is already defined.  Delete it before re-adding it.</em></p>
<p><img src="http://ww4.sinaimg.cn/mw690/6ba3371bjw1ep44bqvkv8j20ez06sgmu.jpg" alt=""></p>
<p>解决办法：<br>先删除，然后在格式化。</p>
<p><img src="http://ww4.sinaimg.cn/mw690/6ba3371bjw1ep44brc1zvj20eu0e1gop.jpg" alt=""></p>
<p>详细命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ23tvhxkkjZ /]# fdisk -S 56 /dev/xvdb&#10;&#10;WARNING: DOS-compatible mode is deprecated. It&#39;s strongly recommended to&#10;         switch off the mode (command &#39;c&#39;) and change display units to&#10;         sectors (command &#39;u&#39;).&#10;&#10;Command (m for help): n&#10;Command action&#10;   e   extended&#10;   p   primary partition (1-4)&#10;p&#10;Partition number (1-4): 1&#10;Partition 1 is already defined.  Delete it before re-adding it.&#10;&#10;Command (m for help): d&#10;Selected partition 1&#10;&#10;Command (m for help): m&#10;Command action&#10;   a   toggle a bootable flag&#10;   b   edit bsd disklabel&#10;   c   toggle the dos compatibility flag&#10;   d   delete a partition&#10;   l   list known partition types&#10;   m   print this menu&#10;   n   add a new partition&#10;   o   create a new empty DOS partition table&#10;   p   print the partition table&#10;   q   quit without saving changes&#10;   s   create a new empty Sun disklabel&#10;   t   change a partition&#39;s system id&#10;   u   change display/entry units&#10;   v   verify the partition table&#10;   w   write table to disk and exit&#10;   x   extra functionality (experts only)&#10;&#10;Command (m for help): n&#10;Command action&#10;   e   extended&#10;   p   primary partition (1-4)&#10;p&#10;Partition number (1-4): 1&#10;First cylinder (1-4405, default 1): &#10;Using default value 1&#10;Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-4405, default 4405): &#10;Using default value 4405&#10;&#10;Command (m for help): wq&#10;The partition table has been altered!&#10;&#10;Calling ioctl() to re-read partition table.&#10;Syncing disks.&#10;[root@iZ23tvhxkkjZ /]#</span><br></pre></td></tr></table></figure></p>
<h3 id="3_u3001_u67E5_u770B_u65B0_u7684_u5206_u533A_u3002"><a href="#3_u3001_u67E5_u770B_u65B0_u7684_u5206_u533A_u3002" class="headerlink" title="3、查看新的分区。"></a>3、查看新的分区。</h3><p>使用“fdisk -l”命令可以看到，新的分区xvdb1已经建立完成了。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bgw1eoqji5dtn0j20fw09xtb7.jpg" alt=""></p>
<h3 id="4_u3001_u683C_u5F0F_u5316_u65B0_u5206_u533A_u3002"><a href="#4_u3001_u683C_u5F0F_u5316_u65B0_u5206_u533A_u3002" class="headerlink" title="4、格式化新分区。"></a>4、格式化新分区。</h3><p>使用“mkfs.ext3 /dev/xvdb1”命令对新分区进行格式化，格式化的时间根据硬盘大小有所不同。(也可自主决定选用 ext4 格式)<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1eoqjls9arxj20hc0b8tbl.jpg" alt=""></p>
<h3 id="5_u3001_u88AB_u6302_u8F7D_u76EE_u5F55_u6587_u4EF6_u5907_u4EFD"><a href="#5_u3001_u88AB_u6302_u8F7D_u76EE_u5F55_u6587_u4EF6_u5907_u4EFD" class="headerlink" title="5、被挂载目录文件备份"></a>5、被挂载目录文件备份</h3><p><strong>注意：挂载磁盘到某个目录下面的内容清除，所以在挂载磁盘前要备份被挂载目录的内容。</strong><br>以var目录为例：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ238dbmjaiZ /]# mkdir varbak&#10;&#22797;&#21046;/var&#25991;&#20214;&#22841;&#21253;&#25324;&#25991;&#20214;&#22841;&#37324;&#30340;&#25152;&#26377;&#25991;&#20214;&#10;[root@iZ238dbmjaiZ /]# cp -r /var /varbak&#10;&#22797;&#21046;/var&#25991;&#20214;&#22841;&#19979;&#25152;&#26377;&#25991;&#20214;&#65292;&#19981;&#21253;&#25324;&#25991;&#20214;&#22841;&#10;[root@iZ238dbmjaiZ /]# cp -Rf /var/* /varbak/</span><br></pre></td></tr></table></figure></p>
<h3 id="6_u3001_u6DFB_u52A0_u5206_u533A_u4FE1_u606F_u3002"><a href="#6_u3001_u6DFB_u52A0_u5206_u533A_u4FE1_u606F_u3002" class="headerlink" title="6、添加分区信息。"></a>6、添加分区信息。</h3><p>使用“echo ‘/dev/xvdb1 /var ext3 defaults 0 0’ &gt;&gt; /etc/fstab”（不含引号）命令写入新分区信息。<br>然后使用“cat /etc/fstab”命令查看，出现以下信息就表示写入成功。<br><img src="http://ww1.sinaimg.cn/mw690/6ba3371bjw1eowcag3q1dj20gv088tbh.jpg" alt=""><br>注：ubuntu12.04不支持barrier，所以正确写法是：echo ‘/dev/xvdb1  /var ext3    barrier=0  0  0’ &gt;&gt; /etc/fstab</p>
<p><em>如果需要把数据盘单独挂载到某个文件夹，比如单独用来存放网页，可以修改以上命令中的/var部分。</em></p>
<h3 id="7_u3001_u6302_u8F7D_u65B0_u5206_u533A"><a href="#7_u3001_u6302_u8F7D_u65B0_u5206_u533A" class="headerlink" title="7、挂载新分区"></a>7、挂载新分区</h3><p>使用“mount -a”命令挂载新分区，然后用“df -h”命令查看，出现以下信息就说明挂载成功，可以开始使用新的分区了。</p>
<p><img src="http://ww1.sinaimg.cn/mw690/6ba3371bjw1eowcafpn9yj20fr02swf5.jpg" alt=""></p>
<h3 id="8_u3001_u88AB_u6302_u8F7D_u76EE_u5F55_u6587_u4EF6_u6062_u590D"><a href="#8_u3001_u88AB_u6302_u8F7D_u76EE_u5F55_u6587_u4EF6_u6062_u590D" class="headerlink" title="8、被挂载目录文件恢复"></a>8、被挂载目录文件恢复</h3><p>拷回被挂载目录的内容。<br>以var目录为例：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#22797;&#21046;/varbak&#25991;&#20214;&#22841;&#19979;&#25152;&#26377;&#25991;&#20214;&#65292;&#19981;&#21253;&#25324;&#25991;&#20214;&#22841;&#10;[root@iZ238dbmjaiZ /]# cp -Rf /varbak/* /var/</span><br></pre></td></tr></table></figure></p>
<p>附：<br>常用命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ238dbmjaiZ /]# df -h&#10;Filesystem      Size  Used Avail Use% Mounted on&#10;/dev/xvda1       20G  2.0G   17G  11% /&#10;tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br></pre></td></tr></table></figure></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ238dbmjaiZ /]# df -i&#10;Filesystem      Inodes IUsed   IFree IUse% Mounted on&#10;/dev/xvda1     1310720 83071 1227649    7% /&#10;tmpfs          1007257     1 1007256    1% /dev/shm</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ238dbmjaiZ /]# fdisk -l&#10;&#10;Disk /dev/xvda: 21.5 GB, 21474836480 bytes&#10;255 heads, 63 sectors/track, 2610 cylinders&#10;Units = cylinders of 16065 * 512 = 8225280 bytes&#10;Sector size (logical/physical): 512 bytes / 512 bytes&#10;I/O size (minimum/optimal): 512 bytes / 512 bytes&#10;Disk identifier: 0x00078f9c&#10;&#10;    Device Boot      Start         End      Blocks   Id  System&#10;/dev/xvda1   *           1        2611    20970496   83  Linux&#10;&#10;Disk /dev/xvdb: 53.7 GB, 53687091200 bytes&#10;255 heads, 56 sectors/track, 7342 cylinders&#10;Units = cylinders of 14280 * 512 = 7311360 bytes&#10;Sector size (logical/physical): 512 bytes / 512 bytes&#10;I/O size (minimum/optimal): 512 bytes / 512 bytes&#10;Disk identifier: 0x0478d339&#10;&#10;    Device Boot      Start         End      Blocks   Id  System&#10;/dev/xvdb1               1        7342    52421852   83  Linux&#10;[root@iZ238dbmjaiZ /]#</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/27/Linux-Glibc-Bug-fixes/" itemprop="url">
                  Linux Glibc漏洞修复
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-27T16:58:58+08:00" content="2015-01-27">
              2015-01-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>日前Linux GNU glibc标准库的 gethostbyname函数爆出缓冲区溢出漏洞，漏洞编号为CVE-2015-0235。黑客可以通过gethostbyname系列函数实现远程代码执行，获取服务器的控制权及Shell权限，此漏洞触发途径多，影响范围大，请大家关注和及时临时修复。 </p>
<h3 id="u4E00_u3001_u6F0F_u6D1E_u53D1_u5E03_u65E5_u671F"><a href="#u4E00_u3001_u6F0F_u6D1E_u53D1_u5E03_u65E5_u671F" class="headerlink" title="一、漏洞发布日期"></a>一、漏洞发布日期</h3><p>2015年1月27日  </p>
<h3 id="u4E8C_u3001_u5DF2_u786E_u8BA4_u88AB_u6210_u529F_u5229_u7528_u7684_u8F6F_u4EF6_u53CA_u7CFB_u7EDF"><a href="#u4E8C_u3001_u5DF2_u786E_u8BA4_u88AB_u6210_u529F_u5229_u7528_u7684_u8F6F_u4EF6_u53CA_u7CFB_u7EDF" class="headerlink" title="二、已确认被成功利用的软件及系统"></a>二、已确认被成功利用的软件及系统</h3><p>Glibc 2.2到2.17 (包含2.2和2.17版本)  </p>
<h3 id="u4E09_u3001_u6F0F_u6D1E_u63CF_u8FF0"><a href="#u4E09_u3001_u6F0F_u6D1E_u63CF_u8FF0" class="headerlink" title="三、漏洞描述"></a>三、漏洞描述</h3><p>GNU glibc标准库的gethostbyname 函数爆出缓冲区溢出漏洞，漏洞编号：CVE-2015-0235。 Glibc 是提供系统调用和基本函数的 C 库，比如open, malloc, printf等等。所有动态连接的程序都要用到Glibc。远程攻击者可以利用这个漏洞执行任意代码并提升运行应用程序的用户的权限。  </p>
<h3 id="u56DB_u3001_u6F0F_u6D1E_u68C0_u6D4B_u65B9_u6CD5"><a href="#u56DB_u3001_u6F0F_u6D1E_u68C0_u6D4B_u65B9_u6CD5" class="headerlink" title="四、漏洞检测方法"></a>四、漏洞检测方法</h3><p>按照说明操作即可。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#60;netdb.h&#62;   &#10;#include &#60;stdio.h&#62;   &#10;#include &#60;stdlib.h&#62;   &#10;#include &#60;string.h&#62;   &#10;#include &#60;errno.h&#62;   &#10;#define CANARY  &#34;in_the_coal_mine&#34;   &#10;struct &#123;   &#10;  char buffer[1024];   &#10;  char canary[sizeof(CANARY)];   &#10;&#125; temp = &#123; &#34;buffer&#34;, CANARY &#125;;   &#10;int main(void) &#123;   &#10;  struct hostent resbuf;   &#10;  struct hostent *result;   &#10;  int herrno;   &#10;  int retval;   &#10;  /*** strlen (name) = size_needed -sizeof (*host_addr) - sizeof (*h_addr_ptrs) - 1; ***/   &#10;  size_t len = sizeof(temp.buffer) -16*sizeof(unsigned char) - 2*sizeof(char *) - 1;   &#10;  char name[sizeof(temp.buffer)];   &#10;  memset(name, &#39;0&#39;, len);   &#10;  name[len] = &#39;\0&#39;;   &#10;  retval = gethostbyname_r(name,&#38;resbuf, temp.buffer, sizeof(temp.buffer), &#38;result, &#38;herrno);   &#10;  if (strcmp(temp.canary, CANARY) !=0) &#123;   &#10;    puts(&#34;vulnerable&#34;);   &#10;    exit(EXIT_SUCCESS);   &#10;  &#125;   &#10;  if (retval == ERANGE) &#123;   &#10;    puts(&#34;notvulnerable&#34;);   &#10;    exit(EXIT_SUCCESS);   &#10;  &#125;   &#10;  puts(&#34;should nothappen&#34;);   &#10;  exit(EXIT_FAILURE);   &#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>将上述代码内容保存为GHOST.c<br>执行gcc GHOST.c -o GHOST<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$./GHOST   &#10;vulnerable</span><br></pre></td></tr></table></figure></p>
<p>表示存在漏洞，需要进行修复。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$./GHOST   &#10;notvulnerable</span><br></pre></td></tr></table></figure></p>
<p>表示修复成功。 </p>
<h3 id="u4E94_u3001_u5EFA_u8BAE_u4FEE_u8865_u65B9_u6848"><a href="#u4E94_u3001_u5EFA_u8BAE_u4FEE_u8865_u65B9_u6848" class="headerlink" title="五、建议修补方案"></a>五、建议修补方案</h3><p>特别提示：由于glibc属于Linux系统基础组件，为了避免修补对您服务器造成影响，建议您选择合适时间进行修复，同时务必在修复前通过快照操作进行备份，如果修复出现问题，可以迅速回滚快照恢复。 </p>
<p>Centos 5/6/7：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update glibc</span><br></pre></td></tr></table></figure></p>
<p>Ubuntu 12/14<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &#10;apt-get install libc6</span><br></pre></td></tr></table></figure></p>
<p>Debian 6<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/apt/sources.list.d/debian6-lts.list http://mirrors.aliyun.com/repo/debian6-lts.list &#10;apt-get update &#10;apt-get install libc6</span><br></pre></td></tr></table></figure></p>
<p>Debian 7<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &#10;apt-get install libc6</span><br></pre></td></tr></table></figure></p>
<p>Opensuse 13<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zypper refresh &#10;zypper update glibc*</span><br></pre></td></tr></table></figure></p>
<p>Aliyun linux 5u7<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/aliyun-5.repo http://mirrors.aliyun.com/repo/aliyun-5.repo  &#10;yum update glibc</span><br></pre></td></tr></table></figure></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/21/C++-Compiler-and-Linker-works/" itemprop="url">
                  C++编译器与链接器工作原理（转）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-21T12:58:58+08:00" content="2015-01-21">
              2015-01-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>这里并没不是讨论大学课程中所学的《编译原理》，只是写一些我自己对C++编译器及链接器的工作原理的理解和看法吧，以我的水平，还达不到讲解编译原理（这个很复杂，大学时几乎没学明白）。</p>
<p>要明白的几个概念：</p>
<ol>
<li>编译：编译器对源文件进行编译，就是把源文件中的文本形式存在的源代码翻译成机器语言形式的目标文件的过程，在这个过程中，编译器会进行一系列的语法检查。如果编译通过，就会把对应的CPP转换成OBJ文件。</li>
<li>编译单元：根据C++标准，每一个CPP文件就是一个编译单元。每个编译单元之间是相互独立并且互相不可知。</li>
<li>目标文件：由编译所生成的文件，以机器码的形式包含了编译单元里所有的代码和数据，还有一些期他信息，如未解决符号表，导出符号表和地址重定向表等。目标文件是以二进制的形式存在的。</li>
</ol>
<p>根据C++标准，一个编译单元（Translation Unit）是指一个.cpp文件以及这所include的所有.h文件，.h文件里面的代码将会被扩展到包含它的.cpp文件里，然后编译器编译该.cpp文件为一个.obj文件，后者拥有PE（Portable Executable，即Windows可执行文件）文件格式，并且本身包含的就是二进制代码，但是不一定能执行，因为并不能保证其中一定有main函数。当编译器将一个工程里的所有.cpp文件以分离的方式编译完毕后，再由链接器进行链接成为一个.exe或.dll文件。</p>
<p>下面让我们来分析一下编译器的工作过程：</p>
<p>我们跳过语法分析，直接来到目标文件的生成，假设我们有一个A.cpp文件，如下定义：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int n = 1;&#10;void FunA()&#10;&#123;&#10;++n;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>它编译出来的目标文件A.obj就会有一个区域（或者说是段），包含以上的数据和函数，其中就有n、FunA，以文件偏移量形式给出可能就是下面这种情况：</p>
<table>
<thead>
<tr>
<th>偏移量</th>
<th style="text-align:center">内容</th>
<th style="text-align:right">长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>0×0000</td>
<td style="text-align:center">n</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td>0×0004</td>
<td style="text-align:center">FunA</td>
<td style="text-align:right">??</td>
</tr>
</tbody>
</table>
<p>注意：这只是说明，与实际目标文件的布局可能不一样，??表示长度未知，目标文件的各个数据可能不是连续的，也不一定是从0×0000开始。</p>
<p>FunA函数的内容可能如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#215;0004 inc DWORD PTR[0x0000]&#10;&#10;0&#215;00?? ret</span><br></pre></td></tr></table></figure></p>
<p>这时++n已经被翻译成inc DWORD PTR[0x0000]，也就是说把本单元0×0000位置的一个DWORD（4字节）加1。</p>
<p>有另外一个B.cpp文件，定义如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extern int n;&#10;void FunB()&#10;&#123;&#10;++n;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>它对应的B.obj的二进制应该是：</p>
<table>
<thead>
<tr>
<th>偏移量</th>
<th style="text-align:center">内容</th>
<th style="text-align:right">长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>0×0000</td>
<td style="text-align:center">FunB</td>
<td style="text-align:right">??</td>
</tr>
</tbody>
</table>
<p>这里为什么没有n的空间呢，因为n被声明为extern，这个extern关键字就是告诉编译器n已经在别的编译单元里定义了，在这个单元里就不要定义了。由于编译单元之间是互不相关的，所以编译器就不知道n究竟在哪里，所以在函数FunB就没有办法生成n的地址，那么函数FunB中就是这样的：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#215;0000 inc DWORD PTR[????]&#10;&#10;0&#215;00?? ret</span><br></pre></td></tr></table></figure></p>
<p>那怎么办呢？这个工作就只能由链接器来完成了。</p>
<p>为了能让链接器知道哪些地方的地址没有填好（也就是还????），那么目标文件中就要有一个表来告诉链接器，这个表就是“未解决符号表”，也就是unresolved symbol table。同样，提供n的目标文件也要提供一个“导出符号表”也就是exprot symbol table，来告诉链接器自己可以提供哪些地址。</p>
<p>好，到这里我们就已经知道，一个目标文件不仅要提供数据和二进制代码外，还至少要提供两个表：未解决符号表和导出符号表，来告诉链接器自己需要什么和自己能提供些什么。那么这两个表是怎么建立对应关系的呢？这里就有一个新的概念：符号。在C/C++中，每一个变量及函数都会有自己的符号，如变量n的符号就是n，函数的符号会更加复杂，假设FunA的符号就是_FunA（根据编译器不同而不同）。</p>
<p>所以，A.obj的导出符号表为</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>0×0000</td>
</tr>
<tr>
<td>_FunA</td>
<td>0×0004</td>
</tr>
</tbody>
</table>
<p>未解决符号为空（因为他没有引用别的编译单元里的东西）。</p>
<p>B.obj的导出符号表为</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>_FunB</td>
<td>0×0000</td>
</tr>
</tbody>
</table>
<p>   未解决符号表为</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>0×0001</td>
</tr>
</tbody>
</table>
<p>这个表告诉链接器，在本编译单元0×0001位置有一个地址，该地址不明，但符号是n。</p>
<p>在链接的时候，链接在B.obj中发现了未解决符号，就会在所有的编译单元中的导出符号表去查找与这个未解决符号相匹配的符号名，如果找到，就把这个符号的地址填到B.obj的未解决符号的地址处。如果没有找到，就会报链接错误。在此例中，在A.obj中会找到符号n，就会把n的地址填到B.obj的0×0001处。</p>
<p>但是，这里还会有一个问题，如果是这样的话，B.obj的函数FunB的内容就会变成inc DWORD PTR[0x000]（因为n在A.obj中的地址是0×0000）,由于每个编译单元的地址都是从0×0000开始，那么最终多个目标文件链接时就会导致地址重复。所以链接器在链接时就会对每个目标文件的地址进行调整。在这个例子中，假如B.obj的0×0000被定位到可执行文件的0×00001000上，而A.obj的0×0000被定位到可执行文件的0×00002000上，那么实现上对链接器来说，A.obj的导出符号地地址都会加上0×00002000，B.obj所有的符号地址也会加上0×00001000。这样就可以保证地址不会重复。</p>
<p>既然n的地址会加上0×00002000，那么FunA中的inc DWORD PTR[0x0000]就是错误的，所以目标文件还要提供一个表，叫地址重定向表，address redirect table。</p>
<p>总结一下：</p>
<p>目标文件至少要提供三个表：未解决符号表，导出符号表和地址重定向表。</p>
<p>未解决符号表：列出了本单元里有引用但是不在本单元定义的符号及其出现的地址。</p>
<p>导出符号表：提供了本编译单元具有定义，并且可以提供给其他编译单元使用的符号及其在本单元中的地址。</p>
<p>地址重定向表：提供了本编译单元所有对自身地址的引用记录。</p>
<p>链接器的工作顺序：</p>
<p>当链接器进行链接的时候，首先决定各个目标文件在最终可执行文件里的位置。然后访问所有目标文件的地址重定义表，对其中记录的地址进行重定向（加上一个偏移量，即该编译单元在可执行文件上的起始地址）。然后遍历所有目标文件的未解决符号表，并且在所有的导出符号表里查找匹配的符号，并在未解决符号表中所记录的位置上填写实现地址。最后把所有的目标文件的内容写在各自的位置上，再作一些另的工作，就生成一个可执行文件。</p>
<p>说明：实现链接的时候会更加复杂，一般实现的目标文件都会把数据，代码分成好向个区，重定向按区进行，但原理都是一样的。</p>
<p>明白了编译器与链接器的工作原理后，对于一些链接错误就容易解决了。</p>
<p>下面再看一看C/C++中提供的一些特性：</p>
<p>extern：这就是告诉编译器，这个变量或函数在别的编译单元里定义了，也就是要把这个符号放到未解决符号表里面去（外部链接）。</p>
<p>static：如果该关键字位于全局函数或者变量的声明前面，表明该编译单元不导出这个函数或变量，因些这个符号不能在别的编译单元中使用（内部链接）。如果是static局部变量，则该变量的存储方式和全局变量一样，但是仍然不导出符号。</p>
<p>默认链接属性：对于函数和变量，默认链接是外部链接，对于const变量，默认内部链接。</p>
<p>外部链接的利弊：外部链接的符号在整个程序范围内都是可以使用的，这就要求其他编译单元不能导出相同的符号（不然就会报duplicated external symbols）。</p>
<p>内部链接的利弊：内部链接的符号不能在别的编译单元中使用。但不同的编译单元可以拥有同样的名称的符号。</p>
<p>为什么头文件里一般只可以有声明不能有定义：头文件可以被多个编译单元包含，如果头文件里面有定义的话，那么每个包含这头文件的编译单元都会对同一个符号进行定义，如果该符号为外部链接，则会导致duplicated external symbols链接错误。</p>
<p>为什么公共使用的内联函数要定义于头文件里：因为编译时编译单元之间互不知道，如果内联被定义于.cpp文件中，编译其他使用该函数的编译单元的时候没有办法找到函数的定义，因些无法对函数进行展开。所以如果内联函数定义于.cpp里，那么就只有这个.cpp文件能使用它。</p>
<p>Via：<a href="http://blog.sina.com.cn/s/blog_5f8817250100i3oz.html" target="_blank" rel="external">C++编译器与链接器工作原理</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/18/weibo-platform-archieture/" itemprop="url">
                  亿级用户下的新浪微博平台架构（转）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-18T18:58:58+08:00" content="2015-01-18">
              2015-01-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u5E8F_u8A00"><a href="#u5E8F_u8A00" class="headerlink" title="序言"></a>序言</h3><p>新浪微博在2014年3月公布的月活跃用户（MAU）已经达到1.43亿，2014年新年第一分钟发送的微博达808298条，如此巨大的用户规模和业务量，需要高可用（HA）、高并发访问、低延时的强大后台系统支撑。<br>微博平台第一代架构为LAMP架构，数据库使用的是MyIsam，后台用的是php，缓存为Memcache。<br>随着应用规模的增长，衍生出的第二代架构对业务功能进行了模块化、服务化和组件化，后台系统从php替换为Java，逐渐形成SOA架构，在很长一段时间支撑了微博平台的业务发展。<br>在此基础上又经过长时间的重构、线上运行、思索与沉淀，平台形成了第三代架构体系。<br>我们先看一张微博的核心业务图（如下），是不是非常复杂？但这已经是一个简化的不能再简化的业务图了，第三代技术体系就是为了保障在微博核心业务上快速、高效、可靠地发布新产品新功能。<br><img src="http://ww2.sinaimg.cn/mw690/6ba3371bjw1eoft2gdubej20li0etdjv.jpg" alt="核心业务图"></p>
<h3 id="u7B2C_u4E09_u4EE3_u6280_u672F_u4F53_u7CFB"><a href="#u7B2C_u4E09_u4EE3_u6280_u672F_u4F53_u7CFB" class="headerlink" title="第三代技术体系"></a>第三代技术体系</h3><p>微博平台的第三代技术体系，使用正交分解法建立模型：在水平方向，采用典型的三级分层模型，即接口层、服务层与资源层；在垂直方向，进一步细分为业务架构、技术架构、监控平台与服务治理平台。下面是平台的整体架构图：<br><img src="http://ww4.sinaimg.cn/mw690/6ba3371bjw1eoft2h6tvej20ha0c70vl.jpg" alt=""><br>如上图所示，正交分解法将整个图分解为3*4=12个区域，每个区域代表一个水平维度与一个垂直维度的交点，相应的定义这个区域的核心功能点，比如区域5主要完成服务层的技术架构。</p>
<p>下面详细介绍水平方向与垂直方向的设计原则，尤其会重点介绍4、5、6中的技术组件及其在整个架构体系中的作用。</p>
<h3 id="u6C34_u5E73_u5206_u5C42"><a href="#u6C34_u5E73_u5206_u5C42" class="headerlink" title="水平分层"></a>水平分层</h3><p>水平维度的划分，在大中型互联网后台业务系统的设计中非常基础，在平台的每一代技术体系中都有体现。这里还是简单介绍一下，为后续垂直维度的延伸讲解做铺垫：</p>
<ol>
<li>接口层主要实现与Web页面、移动客户端的接口交互，定义统一的接口规范，平台最核心的三个接口服务分别是内容（Feed）服务、用户关系服务及通讯服务（单发私信、群发、群聊）。</li>
<li>服务层主要把核心业务模块化、服务化，这里又分为两类服务，一类为原子服务，其定义是不依赖任何其他服务的服务模块，比如常用的短链服务、发号器服务都属于这一类。图中使用泳道隔离，表示它们的独立性。另外一类为组合服务，通过各种原子服务和业务逻辑的组合来完成服务，比如Feed服务、通讯服务，它们除了本身的业务逻辑，还依赖短链、用户及发号器服务。</li>
<li>资源层主要是数据模型的存储，包含通用的缓存资源Redis和Memcached，以及持久化数据库存储MySQL、HBase，或者分布式文件系统TFS以及Sina S3服务。</li>
</ol>
<p>水平分层有一个特点，依赖关系都是从上往下，上层的服务依赖下层，下层的服务不会依赖上层，构建了一种简单直接的依赖关系。<br>与分层模型相对应，微博系统中的服务器主要包括三种类型：前端机（提供 API 接口服务）、队列机（处理上行业务逻辑，主要是数据写入）和存储（mc、mysql、mcq、redis 、HBase等）。</p>
<h3 id="u5782_u76F4_u5EF6_u4F38_u6280_u672F_u67B6_u6784"><a href="#u5782_u76F4_u5EF6_u4F38_u6280_u672F_u67B6_u6784" class="headerlink" title="垂直延伸技术架构"></a>垂直延伸技术架构</h3><p>随着业务架构的发展和优化，平台研发实现了许多卓越的中间件产品，用来支撑核心业务，这些中间件由业务驱动产生，随着技术组件越来越丰富，形成完备的平台技术框架，大大提升了平台的产品研发效率和业务运行稳定性。</p>
<p>区别于水平方向上层依赖下层的关系，垂直方向以技术框架为地基支撑点，向两侧驱动影响业务架构、监控平台、服务治理平台，下面介绍一下其中的核心组件。</p>
<h3 id="u63A5_u53E3_u5C42Web_V4_u6846_u67B6"><a href="#u63A5_u53E3_u5C42Web_V4_u6846_u67B6" class="headerlink" title="接口层Web V4框架"></a>接口层Web V4框架</h3><p>接口框架简化和规范了业务接口开发工作，将通用的接口层功能打包到框架中，采用了Spring的面向切面（AOP）设计理念。接口框架基于Jersey 进行二次开发，基于annotation定义接口(url, 参数)，内置Auth、频次控制、访问日志、降级功能，支撑接口层监控平台与服务治理，同时还有自动化的Bean-json/xml序列化。</p>
<h3 id="u670D_u52A1_u5C42_u6846_u67B6"><a href="#u670D_u52A1_u5C42_u6846_u67B6" class="headerlink" title="服务层框架"></a>服务层框架</h3><p>服务层主要涉及RPC远程调用框架以及消息队列框架，这是微博平台在服务层使用最为广泛的两个框架。</p>
<h3 id="MCQ_u6D88_u606F_u961F_u5217"><a href="#MCQ_u6D88_u606F_u961F_u5217" class="headerlink" title="MCQ消息队列"></a>MCQ消息队列</h3><p>消息队列提供一种先入先出的通讯机制，在平台内部，最常见的场景是将数据的落地操作异步写入队列，队列处理程序批量读取并写入DB，消息队列提供的异步机制加快了前端机的响应时间，其次，批量的DB操作也间接提高了DB操作性能，另外一个应用场景，平台通过消息队列，向搜索、大数据、商业运营部门提供实时数据。</p>
<p>微博平台内部大量使用的MCQ(SimpleQueue Service Over Memcache)消息队列服务，基于MemCache协议，消息数据持久化写入BerkeleyDB，只有get/set两个命令，同时也非常容易做监控（stats queue），有丰富的client library，线上运行多年，性能比通用的MQ高很多倍。</p>
<h3 id="Motan_RPC_u6846_u67B6"><a href="#Motan_RPC_u6846_u67B6" class="headerlink" title="Motan RPC框架"></a>Motan RPC框架</h3><p>微博的Motan RPC服务，底层通讯引擎采用了Netty网络框架，序列化协议支持Hessian和Java序列化，通讯协议支持Motan、http、tcp、mc等，Motan框架在内部大量使用，在系统的健壮性和服务治理方面，有较为成熟的技术解决方案，健壮性上，基于Config配置管理服务实现了High Availability与Load Balance策略（支持灵活的FailOver和FailFast HA策略，以及Round Robin、LRU、Consistent Hash等Load Balance策略），服务治理方面，生成完整的服务调用链数据，服务请求性能数据，响应时间（Response Time）、QPS以及标准化Error、Exception日志信息。</p>
<h3 id="u8D44_u6E90_u5C42_u6846_u67B6"><a href="#u8D44_u6E90_u5C42_u6846_u67B6" class="headerlink" title="资源层框架"></a>资源层框架</h3><p>资源层的框架非常多，有封装MySQL与HBase的Key-List DAL中间件、有定制化的计数组件，有支持分布式MC与Redis的Proxy，在这些方面业界有较多的经验分享，我在这里分享一下平台架构的对象库与SSD Cache组件。</p>
<h3 id="u5BF9_u8C61_u5E93"><a href="#u5BF9_u8C61_u5E93" class="headerlink" title="对象库"></a>对象库</h3><p>对象库支持便捷的序列化与反序列化微博中的对象数据：序列化时，将JVM内存中的对象序列化写入在HBase中并生成唯一的ObjectID，当需要访问该对象时，通过ObjectID读取，对象库支持任意类型的对象，支持PB、JSON、二进制序列化协议，微博中最大的应用场景将微博中引用的视频、图片、文章统一定义为对象，一共定义了几十种对象类型，并抽象出标准的对象元数据Schema，对象的内容上传到对象存储系统（Sina S3）中，对象元数据中保存Sina S3的下载地址。</p>
<h3 id="SSDCache"><a href="#SSDCache" class="headerlink" title="SSDCache"></a>SSDCache</h3><p>随着SSD硬盘的普及，优越的IO性能使其被越来越多地用于替换传统的SATA和SAS磁盘，常见的应用场景有三种：1）替换MySQL数据库的硬盘，目前社区还没有针对SSD优化的MySQL版本，即使这样，直接升级SSD硬盘也能带来8倍左右的IOPS提升；2）替换Redis的硬盘，提升其性能；3）用在CDN中，加快静态资源加载速度。</p>
<p>微博平台将SSD应用在分布式缓存场景中，将传统的Redis/MC + Mysql方式，扩展为 Redis/MC + SSD Cache + Mysql方式，SSD Cache作为L2缓存使用，第一降低了MC/Redis成本过高，容量小的问题，也解决了穿透DB带来的数据库访问压力。</p>
<h3 id="u5782_u76F4_u7684_u76D1_u63A7_u4E0E_u670D_u52A1_u6CBB_u7406"><a href="#u5782_u76F4_u7684_u76D1_u63A7_u4E0E_u670D_u52A1_u6CBB_u7406" class="headerlink" title="垂直的监控与服务治理"></a>垂直的监控与服务治理</h3><p>随着服务规模和业务变得越来越复杂，即使业务架构师也很难准确地描述服务之间的依赖关系，服务的管理运维变得越来难，在这个背景下，参考google的dapper和twitter的zipkin，平台实现了自己的大型分布式追踪系统WatchMan。</p>
<h3 id="WatchMan_u5927_u578B_u5206_u5E03_u5F0F_u8FFD_u8E2A_u7CFB_u7EDF"><a href="#WatchMan_u5927_u578B_u5206_u5E03_u5F0F_u8FFD_u8E2A_u7CFB_u7EDF" class="headerlink" title="WatchMan大型分布式追踪系统"></a>WatchMan大型分布式追踪系统</h3><p>如其他大中型互联网应用一样，微博平台由众多的分布式组件构成，用户通过浏览器或移动客户端的每一个HTTP请求到达应用服务器后，会经过很多个业务系统或系统组件，并留下足迹（footprint）。但是这些分散的数据对于问题排查，或是流程优化都帮助有限。对于这样一种典型的跨进程/跨线程的场景，汇总收集并分析这类日志就显得尤为重要。另一方面，收集每一处足迹的性能数据，并根据策略对各子系统做流控或降级，也是确保微博平台高可用的重要因素。要能做到追踪每个请求的完整调用链路；收集调用链路上每个服务的性能数据；能追踪系统中所有的Error和Exception；通过计算性能数据和比对性能指标（SLA）再回馈到控制流程（control flow）中，基于这些目标就诞生了微博的Watchman系统。</p>
<p>该系统设计的一个核心原则就是低侵入性（non-invasivenss）：作为非业务组件，应当尽可能少侵入或者不侵入其他业务系统，保持对使用方的透明性，可以大大减少开发人员的负担和接入门槛。基于此考虑，所有的日志采集点都分布在技术框架中间件中，包括接口框架、RPC框架以及其他资源中间件。</p>
<p>WatchMan由技术团队搭建框架，应用在所有业务场景中，运维基于此系统完善监控平台，业务和运维共同使用此系统，完成分布式服务治理，包括服务扩容与缩容、服务降级、流量切换、服务发布与灰度。</p>
<h3 id="u7ED3_u5C3E"><a href="#u7ED3_u5C3E" class="headerlink" title="结尾"></a>结尾</h3><p>现在，技术框架在平台发挥着越来越重要的作用，驱动着平台的技术升级、业务开发、系统运维服务，本文限于篇幅限制，没有展开介绍，后续会不断地介绍核心中间件的设计原则和系统架构。</p>
<p>via:<a href="http://www.infoq.com/cn/articles/weibo-platform-archieture" target="_blank" rel="external">http://www.infoq.com/cn/articles/weibo-platform-archieture</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/18/I-had-been-to-your-world/" itemprop="url">
                  你的世界我曾来过
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-18T18:18:18+08:00" content="2015-01-18">
              2015-01-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/音十文集/" itemprop="url" rel="index">
                    <span itemprop="name">音十文集</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>走了很远很远的路后，再回首，纷扰的往事如潮退去，岁月的沙滩上，只留下一层亮晶晶的珠贝——那是从记忆的深海里冲上来的，是我们这一路遇到的一个个人的背影。赤足走在细软的沙上，俯身拣拾一个个微小的片段，在我，是最温暖的事。我总是能从这样的回望里，获得足够多直面现实的力量。总能从渐去渐远的步履里，寻觅到一种深深的感动，在一遍遍悠长的回味中，独自微笑，或不由自主地落下泪来。</p>
<p>人生的道路蜿蜒伸向远方，前行的路上必定有相遇。仅仅相遇还是不够的，从相遇到相识，从相识到相知，这是一个奇异的历程，仿佛在渐次打开一个深广的世界。一个人就是一个世界，一个世界和多个世界重叠，针来线往地密密交织，云舒云卷地纵横飞渡，就组成了我们浩繁人生的章回。但谁能走遍谁的角角落落，谁能拥有谁的一生呢。或许我们耗去一辈子的时光，也无法走进一个人的世界半步。或许我们一见如故，瞬间就抵达了对方的心灵，成为生死与共的至交。或许我们自己的内心，也是一座荒凉的小岛，年复一年，从来没有任何人或船只靠近，一片寂静里，只有浪花拍击岸堤的回响……</p>
<p>无眠的深夜，凝望星空，想起一路遇到的人，一张张或清晰或模糊的脸庞，浮光掠影的一晃而过，像闪电照亮了我们的生命。心中，总是充满别样的温情。我们永远也不知道，下一刻，前行的路上将会遇到什么样的人，发生什么样的事，遭遇什么样的坎坷。但我们知道的是，来时的路上，有多少人值得我们终生去铭记，去感恩，去以柔软的心情，细细地牵念与祝福。那些雨中伸来的手，雪中送来的炭；那些山中开出的路，水上架起的桥；那些悲悯的泪，真诚的话，关切的眼神，无一不深深地烙印在我们的记忆里，成为我们心中永开不败的花朵。</p>
<p>在一个村庄住久了，会结识一些人。在一个城市住久了，又会结识一些人。无论在哪个地方、哪个领域生活或学习，总会结识一些人。这些人见证着我们曾经的岁月，收藏着我们以往的点滴，温暖着我们漂泊的灵魂，让我们分离时万般不舍，远行时情怀缱绻，回首时泪眼迷蒙。这些人，以及和这些人有关的一切，比如幽深的小巷、巷头纷纷飘落的榆钱儿。比如黄昏的站牌、站牌下等待的少年。比如飞扬的围巾，爱着的眼睛，满月一样的脸。比如雪夜的诗歌，以及诗歌后面的忧伤。让我们无论相隔多少年，无论去往何方，都能心情湿润地想起，并且永远也不会忘记。</p>
<p>还有一些人，与我们隔着几个朝代的时间距离，但他们思想的光芒破空而来，照彻我们的黑夜，像促膝而坐一样亲切而熟悉。</p>
<p>还有一些人，与我们相隔万水千山，或许今生都不能谋面，无由相逢。但谁说最沉默的不是最深情的，最远的不是最近的呢？在无数次心灵的相逢里，我眼含热泪，轻轻地告诉你，记住，我想念你。记住，你的世界我曾来过。那一地月光，那一树花影，那春去秋回的脚步声，是我刻在你世界上的痕迹……</p>
<p><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1eow1haom6vj20im0dxt9k.jpg" alt="独墅湖"><br><img src="http://ww3.sinaimg.cn/mw690/6ba3371bjw1eow1hb8uy1j20ku0dv43r.jpg" alt="景色"></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://ww3.sinaimg.cn/mw690/6ba3371bgw1ei1yg6iujij209l09rwg2.jpg" alt="ZhangYouzhi" itemprop="image"/>
          <p class="site-author-name" itemprop="name">ZhangYouzhi</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Where there is a will, there is a way!</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">59</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">35</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhangYouzhi</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
